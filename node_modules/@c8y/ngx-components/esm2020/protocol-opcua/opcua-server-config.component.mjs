import { Component, Input, Output, EventEmitter, ViewChild } from '@angular/core';
import { gettext, DropAreaComponent } from '@c8y/ngx-components';
import { cloneDeep, has } from 'lodash-es';
import { OpcuaService } from './opcuaService';
import * as i0 from "@angular/core";
import * as i1 from "./opcuaService";
import * as i2 from "@c8y/ngx-components";
import * as i3 from "@angular/common";
import * as i4 from "@angular/forms";
import * as i5 from "ngx-bootstrap/buttons";
export class OpcuaServerConfigComponent {
    constructor(opcuaService) {
        this.fileName = '';
        this.targetConnectionState = '1';
        this.minIntervalNumber = 1;
        this.connectionStatusLabel = '';
        this.canceled = new EventEmitter();
        this.removed = new EventEmitter();
        this.saved = new EventEmitter();
        this.changePassword = false;
        this.initialPasswordRequired = true;
        this.NONE = 'NONE';
        this.SIGN = 'SIGN';
        this.SIGN_ENC = 'SIGN_ENCRYPT';
        this.securityPolicies = {
            sign: [`BASIC256_${this.SIGN}`, `BASIC128RSA15_${this.SIGN}`, `BASIC256SHA256_${this.SIGN}`],
            sign_enc: [
                `BASIC256_${this.SIGN_ENC}`,
                `BASIC128RSA15_${this.SIGN_ENC}`,
                `BASIC256SHA256_${this.SIGN_ENC}`
            ]
        };
        this.ANONYM = {
            id: 1,
            value: gettext('Anonymous')
        };
        this.USER_PASSWORD = {
            id: 2,
            value: gettext('Username/Password')
        };
        this.KEY_BASED = {
            id: 3,
            value: gettext('Key-based Authentication')
        };
        this.initialKeystore = {
            lastModified: 0,
            name: '',
            type: '',
            slice: null,
            size: 0
        };
        this.keystore = this.initialKeystore;
        this.authSwitch = false;
        this.opcuaService = opcuaService;
    }
    set server(server) {
        this._server = cloneDeep(server);
        if (server) {
            this.model = cloneDeep(server);
            this.fileName = this.model.config.keystoreFilename;
            if (server.id && server.id === 'new') {
                // enabled connection state
                this.targetConnectionState = '1';
                this.model.config.targetConnectionState = 'enabled';
            }
            else {
                this.targetConnectionState =
                    this.model.config.targetConnectionState === 'enabled' ? '1' : '0';
            }
            this.updateConnectionStatusLabel(this._server);
            this.setNewPassword();
        }
    }
    get server() {
        return this._server;
    }
    async ngOnInit() {
        this.authSwitch = false;
        this.securityModes = [this.NONE, this.SIGN, this.SIGN_ENC];
        this.authenticationModes = [this.ANONYM, this.USER_PASSWORD, this.KEY_BASED];
        this.setCurrentAuthenticationMode();
        this.setCurrentSecurityMode();
    }
    ngOnChanges() {
        this.setCurrentSecurityMode();
        this.setCurrentAuthenticationMode();
    }
    cancel() {
        this.canceled.emit(this.model);
        this._server = null;
    }
    async remove() {
        await this.removeKeystore(this.model);
        this.removed.emit(this.model);
        this._server = null;
    }
    async save() {
        if (this.keystore &&
            this.keystore.size > 0 &&
            this.keystore.name &&
            this.keystore.name.length > 0) {
            const response = await this.uploadKeystore(this.model.config.keystoreBinaryId);
            if (response && response.data && response.data.id) {
                this.model.config.keystoreBinaryId = response.data.id;
            }
            // if the keystore was uploaded successful we can remove
            // the local keystore. This will prevent another request to binary api
            // when the user will edit other inputs in the form and hit save again.
            this.keystore = this.initialKeystore;
        }
        // will remove keystore (binary) when the user switched
        // authentication settings from key-based to anonymous or username/password
        if (this.authSwitch) {
            this.removeKeystore(this.server);
        }
        // when the user sets a new password, make sure to mark it as
        // "not encrypted" by setting passwordEncrypted to false
        const userPassword = this.getModelConfig('userPassword');
        if (userPassword && userPassword.length > 0) {
            this.model.config.passwordEncrypted = false;
        }
        this.saved.emit(this.model);
    }
    uploadFile(droppedFiles) {
        if (droppedFiles.length === 1) {
            this.keystore = droppedFiles[0].file;
            this.fileName = this.keystore.name;
        }
        else {
            // dropped more than one file
            console.warn('Tried to import... Import aborted.');
        }
    }
    setPolicy(data) {
        if (data === this.NONE) {
            this.model.config.securityMode = this.NONE;
        }
        else if (data === this.SIGN) {
            this.model.config.securityMode = this.securityPolicies.sign[0];
        }
        else if (data === this.SIGN_ENC) {
            this.model.config.securityMode = this.securityPolicies.sign_enc[0];
        }
    }
    setServerConnection(data) {
        this.model.config.targetConnectionState = data !== '0' ? 'enabled' : 'disabled';
    }
    updateAuthentication(data) {
        if (data && data.id) {
            switch (data.id) {
                // Anonymous
                case 1:
                    this.resetUserAuthentication();
                    this.resetKeyBasedAuthentication();
                    break;
                // User/Password
                case 2:
                    this.resetKeyBasedAuthentication();
                    this.restoreUserData();
                    this.setNewPassword();
                    break;
                // Key-based
                case 3:
                    this.resetUserAuthentication();
                    this.restoreKeyBasedData();
                    break;
                default:
                    console.warn('Invalid authentication id', data.id);
                    break;
            }
        }
    }
    updateConnectionStatusLabel(server) {
        const connected = server.c8y_Connection && server.c8y_Connection.status === 'CONNECTED';
        const label = connected ? gettext('Connected') : gettext('Disconnected');
        this.connectionStatusLabel = label;
    }
    setNewPassword() {
        const username = this.getModelConfig('userName');
        if (username && username.length > 0) {
            // userName is given, NO need to change the password because it is already set
            this.changePassword = false;
            this.initialPasswordRequired = false;
        }
        else {
            // no userName in response, so require the user to set the initial pw
            this.changePassword = true;
            this.initialPasswordRequired = true;
        }
    }
    toggleChangePassword() {
        this.changePassword = !this.changePassword;
        // When the user hides the pw-input field but has entered a
        // string to it before, we need to discard the changes reflected in the model
        // otherwise we PUT it with the model when user hits the save button
        if (!this.changePassword) {
            if (this.getModelConfig('userPassword')) {
                delete this.model.config.userPassword;
            }
        }
    }
    uploadKeystore(binaryId) {
        if (!binaryId) {
            return this.opcuaService.uploadKeystore(this.keystore);
        }
        else if (binaryId && binaryId.length > 0) {
            // update existing binary
            return this.opcuaService.updateKeystore(binaryId, this.keystore);
        }
    }
    removeKeystore(server) {
        if (server &&
            server.config &&
            server.config.keystoreBinaryId &&
            server.config.keystoreBinaryId.length > 0) {
            this.authSwitch = false;
            return this.opcuaService.removeKeystore(this.server.config.keystoreBinaryId);
        }
    }
    resetUserAuthentication() {
        this.model.config.userName = null;
        this.model.config.userPassword = null;
        this.model.config.userIdentityMode = 'none';
    }
    resetKeyBasedAuthentication() {
        this.authSwitch = true;
        this.model.config.keystorePass = null;
        this.model.config.certificatePass = null;
        this.model.config.keystoreBinaryId = '';
        this.model.config.keystoreFilename = '';
        this.model.config.userIdentityMode = 'none';
    }
    restoreUserData() {
        this.model.config.userName = this._server.config.userName;
        this.model.config.userIdentityMode = 'userAndPassword';
    }
    restoreKeyBasedData() {
        this.authSwitch = false;
        this.model.config.keystorePass = this._server.config.keystorePass;
        this.model.config.certificatePass = this._server.config.certificatePass;
        this.model.config.keystoreBinaryId = this._server.config.keystoreBinaryId;
        this.model.config.keystoreFilename = this._server.config.keystoreFilename;
        this.model.config.userIdentityMode = 'certificate';
    }
    getServerConfig() {
        let cfg = {
            securityMode: this.NONE,
            userIdentityMode: 'none'
        };
        if (this.server && this.server.config) {
            cfg = this.server.config;
        }
        return cfg;
    }
    setCurrentSecurityMode() {
        const { securityMode } = this.getServerConfig();
        if (securityMode) {
            const foundInSign = this.securityPolicies.sign.find(el => el === securityMode);
            if (foundInSign) {
                this.currentSecMode = this.SIGN;
            }
            else {
                const foundInSignEncrypt = this.securityPolicies.sign_enc.find(el => el === securityMode);
                foundInSignEncrypt
                    ? (this.currentSecMode = this.SIGN_ENC)
                    : (this.currentSecMode = this.NONE);
            }
        }
    }
    setCurrentAuthenticationMode() {
        const { userIdentityMode } = this.getServerConfig();
        switch (userIdentityMode) {
            case 'certificate':
                this.authenticationMode = this.KEY_BASED;
                break;
            case 'userAndPassword':
                this.authenticationMode = this.USER_PASSWORD;
                break;
            case 'Anonymous':
                this.authenticationMode = this.ANONYM;
                break;
            case 'UserName':
                this.authenticationMode = this.USER_PASSWORD;
                break;
            case 'Certificate':
                this.authenticationMode = this.KEY_BASED;
                break;
            default:
                this.authenticationMode = this.ANONYM;
                break;
        }
    }
    getModelConfig(fragment) {
        if (this.model && this.model.config) {
            if (fragment && fragment.length > 0) {
                return has(this.model.config, fragment) ? this.model.config[`${fragment}`] : undefined;
            }
        }
        return undefined;
    }
}
OpcuaServerConfigComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: OpcuaServerConfigComponent, deps: [{ token: i1.OpcuaService }], target: i0.ɵɵFactoryTarget.Component });
OpcuaServerConfigComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.0.6", type: OpcuaServerConfigComponent, selector: "opcua-server-config", inputs: { server: "server" }, outputs: { canceled: "canceled", removed: "removed", saved: "saved" }, viewQueries: [{ propertyName: "opcuaConfigForm", first: true, predicate: ["opcuaConfigForm"], descendants: true }, { propertyName: "dropArea", first: true, predicate: DropAreaComponent, descendants: true }], usesOnChanges: true, ngImport: i0, template: "<div class=\"c8y-empty-state m-t-4\" *ngIf=\"!server\">\n  <h1 class=\"c8y-icon c8y-icon-duocolor\" c8yIcon=\"server\"></h1>\n  <div>\n    <p class=\"text-medium\">{{ 'No server to display.' | translate }}</p>\n    <p>{{ 'Add or select a server.' | translate }}</p>\n  </div>\n</div>\n\n<form #opcuaConfigForm=\"ngForm\" class=\"d-contents\" *ngIf=\"server\">\n  <div class=\"card-header large-padding separator sticky-top visible-sm visible-xs\">\n    <button\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      title=\"{{ 'Back' | translate }}\"\n      (click)=\"cancel()\"\n    >\n      <i c8yIcon=\"chevron-left\"></i>\n      {{ 'Back' | translate }}\n    </button>\n  </div>\n  <div class=\"flex-grow\">\n    <div class=\"card-block large-padding\">\n      <!-- SERVER NAME -->\n      <c8y-form-group class=\"m-b-8\">\n        <label>\n          {{ 'Server name' | translate }}\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          placeholder=\"{{ 'e.g. My server' | translate }}\"\n          id=\"name\"\n          name=\"name\"\n          [(ngModel)]=\"model.name\"\n          required\n        />\n        <c8y-messages>\n          <c8y-message\n            name=\"required\"\n            text=\"{{ 'Server name is required' | translate }}\"\n          ></c8y-message>\n        </c8y-messages>\n      </c8y-form-group>\n    </div>\n\n    <div class=\"card-block large-padding bg-level-2\">\n      <div class=\"tight-grid\">\n        <div class=\"col-sm-6\">\n          <label class=\"fit-w\" translate>Server connection</label>\n          <button\n            type=\"button\"\n            class=\"btn m-t-4\"\n            name=\"serverConnection\"\n            [(ngModel)]=\"targetConnectionState\"\n            (ngModelChange)=\"setServerConnection($event)\"\n            btnCheckbox\n            btnCheckboxTrue=\"1\"\n            btnCheckboxFalse=\"0\"\n          >\n            <span title=\"{{ 'Enabled' | translate }}\" [hidden]=\"targetConnectionState !== '1'\">\n              {{ 'Enabled' | translate }}\n            </span>\n            <span title=\"{{ 'Disabled' | translate }}\" [hidden]=\"targetConnectionState !== '0'\">\n              {{ 'Disabled' | translate }}\n            </span>\n          </button>\n        </div>\n        <div class=\"col-sm-6\">\n          <label translate>Connection status</label>\n          <div class=\"form-control-static\">\n            <device-status class=\"p-r-8\" [mo]=\"server\"></device-status>\n            <span>{{ connectionStatusLabel | translate }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <!-- SERVER URL-->\n      <c8y-form-group>\n        <label for=\"configServerUrl\" translate>Server URL</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"configServerUrl\"\n          name=\"serverUrl\"\n          [(ngModel)]=\"model.config.serverUrl\"\n          c8yDefaultValidation=\"opcuaBrowsePath\"\n          required\n        />\n      </c8y-form-group>\n\n      <!-- TIMEOUT & STATUS-CHECK-INTERVAL-->\n      <div class=\"content-flex-32\">\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.timeout\" translate>Timeout</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.timeout\"\n                name=\"timeout\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 30\"\n                [(ngModel)]=\"model.config.timeout\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.statusCheckInterval\" translate>Status check interval</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.statusCheckInterval\"\n                name=\"statusCheckInterval\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 40\"\n                [(ngModel)]=\"model.config.statusCheckInterval\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n      </div>\n\n      <!-- SECURITY MODE -->\n      <div class=\"tight-grid\">\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <!-- NONE, SIGN, SIGN & ENCRYPT-->\n            <label for=\"config.securityMode\" translate>Security mode</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                class=\"form-control\"\n                id=\"config.securityMode\"\n                [(ngModel)]=\"currentSecMode\"\n                (ngModelChange)=\"setPolicy($event)\"\n                name=\"securityMode\"\n                required\n              >\n                <option *ngFor=\"let mode of securityModes\" [ngValue]=\"mode\">{{ mode }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode === NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.securityPolicy\"\n              name=\"securityPolicy\"\n              [readonly]=\"true\"\n              [(ngModel)]=\"model.config.securityMode\"\n              required\n            />\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode !== NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                *ngIf=\"currentSecMode === SIGN\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <select\n                *ngIf=\"currentSecMode === SIGN_ENC\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign_enc\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- AUTHENTICATION -->\n      <div class=\"form-group\">\n        <label for=\"config.authenticationMode\" translate>Authentication</label>\n        <div class=\"c8y-select-wrapper\">\n          <select\n            class=\"form-control\"\n            id=\"config.authenticationMode\"\n            [(ngModel)]=\"authenticationMode\"\n            name=\"authenticationMode\"\n            (ngModelChange)=\"updateAuthentication($event)\"\n            required\n          >\n            <option *ngFor=\"let auth of authenticationModes\" [ngValue]=\"auth\">\n              {{ auth.value | translate }}\n            </option>\n          </select>\n          <span></span>\n        </div>\n      </div>\n\n      <!-- User/Pw-->\n      <div *ngIf=\"authenticationMode.id === 2\" class=\"tight-grid\">\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"config.userName\" translate>Username</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.userName\"\n              name=\"userName\"\n              placeholder=\"{{ 'e.g. joe.doe`LOCALIZE`' | translate }}\"\n              [(ngModel)]=\"model.config.userName\"\n              autocomplete=\"new-password\"\n              required\n            />\n          </div>\n        </div>\n        <!-- change password section BEGINS-->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\" *ngIf=\"!initialPasswordRequired\">\n            <button type=\"button\" class=\"btn btn-default\" (click)=\"toggleChangePassword()\">\n              <ng-container *ngIf=\"!changePassword\">\n                {{ 'Change password' | translate }}\n              </ng-container>\n              <ng-container *ngIf=\"changePassword\">\n                {{ 'Cancel password change' | translate }}\n              </ng-container>\n            </button>\n          </div>\n\n          <div class=\"form-group\">\n            <div *ngIf=\"changePassword\">\n              <label for=\"config.password\" translate>Password</label>\n              <input\n                type=\"password\"\n                class=\"form-control\"\n                id=\"config.userPassword\"\n                name=\"password\"\n                [(ngModel)]=\"model.config.userPassword\"\n                autocomplete=\"new-password\"\n                required\n              />\n            </div>\n          </div>\n        </div>\n        <!-- change password section ENDS-->\n      </div>\n      <!-- Key-based -->\n      <div *ngIf=\"authenticationMode.id === 3\" class=\"tight-grid\">\n        <!-- KEYSTORE PASSWORD -->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.keystorePass\" translate>Keystore password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.keystorePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.keystorePass\"\n              required\n            />\n          </div>\n        </div>\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.certificatePass\" translate>Certificate password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.certificatePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.certificatePass\"\n              required\n            />\n          </div>\n        </div>\n        <!-- UPLOAD KEYSTORE -->\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"certificateUpload\" translate>Upload keystore</label>\n            <input\n              type=\"text\"\n              [readonly]=\"true\"\n              name=\"certificateUpload\"\n              class=\"form-control m-b-8\"\n              [ngModel]=\"fileName\"\n              placeholder=\"{{ 'e.g.' | translate }} yourKeystore.jks\"\n              required\n            />\n            <c8y-drop-area\n              (dropped)=\"uploadFile($event)\"\n              [loadingMessage]=\"'Importing, please wait.' | translate\"\n              [title]=\"'Import keystore with jks file extension' | translate\"\n            ></c8y-drop-area>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer large-padding separator sticky-bottom\">\n    <button\n      title=\"{{ 'Cancel' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-default\"\n      (click)=\"cancel()\"\n    >\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Remove' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-danger\"\n      (click)=\"remove()\"\n    >\n      {{ 'Remove' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Save' | translate }}\"\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      (click)=\"save()\"\n      [disabled]=\"!opcuaConfigForm.valid\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n", dependencies: [{ kind: "directive", type: i2.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i2.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.DropAreaComponent, selector: "c8y-drop-area", inputs: ["formControl", "title", "message", "icon", "loadingMessage", "forceHideList", "alwaysShow", "clickToOpen", "loading", "progress", "maxAllowedFiles", "files", "maxFileSizeInMegaBytes", "accept"], outputs: ["dropped"] }, { kind: "directive", type: i2.DefaultValidationDirective, selector: "[c8yDefaultValidation]", inputs: ["c8yDefaultValidation"] }, { kind: "directive", type: i2.MinValidationDirective, selector: "[min]", inputs: ["min"] }, { kind: "directive", type: i4.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i4.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i4.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NumberValueAccessor, selector: "input[type=number][formControlName],input[type=number][formControl],input[type=number][ngModel]" }, { kind: "directive", type: i4.SelectControlValueAccessor, selector: "select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]", inputs: ["compareWith"] }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i4.RequiredValidator, selector: ":not([type=checkbox])[required][formControlName],:not([type=checkbox])[required][formControl],:not([type=checkbox])[required][ngModel]", inputs: ["required"] }, { kind: "directive", type: i4.MinValidator, selector: "input[type=number][min][formControlName],input[type=number][min][formControl],input[type=number][min][ngModel]", inputs: ["min"] }, { kind: "directive", type: i4.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: i4.NgForm, selector: "form:not([ngNoForm]):not([formGroup]),ng-form,[ngForm]", inputs: ["ngFormOptions"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "component", type: i2.FormGroupComponent, selector: "c8y-form-group", inputs: ["hasError", "hasWarning", "hasSuccess", "novalidation", "status"] }, { kind: "directive", type: i2.MessageDirective, selector: "c8y-message", inputs: ["name", "text"] }, { kind: "component", type: i2.MessagesComponent, selector: "c8y-messages", inputs: ["show", "defaults"] }, { kind: "directive", type: i2.RequiredInputPlaceholderDirective, selector: "input[required], input[formControlName]" }, { kind: "component", type: i2.DeviceStatusComponent, selector: "device-status", inputs: ["mo"] }, { kind: "directive", type: i5.ButtonCheckboxDirective, selector: "[btnCheckbox]", inputs: ["btnCheckboxTrue", "btnCheckboxFalse"] }, { kind: "pipe", type: i2.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: OpcuaServerConfigComponent, decorators: [{
            type: Component,
            args: [{ selector: 'opcua-server-config', template: "<div class=\"c8y-empty-state m-t-4\" *ngIf=\"!server\">\n  <h1 class=\"c8y-icon c8y-icon-duocolor\" c8yIcon=\"server\"></h1>\n  <div>\n    <p class=\"text-medium\">{{ 'No server to display.' | translate }}</p>\n    <p>{{ 'Add or select a server.' | translate }}</p>\n  </div>\n</div>\n\n<form #opcuaConfigForm=\"ngForm\" class=\"d-contents\" *ngIf=\"server\">\n  <div class=\"card-header large-padding separator sticky-top visible-sm visible-xs\">\n    <button\n      class=\"btn btn-clean text-primary visible-sm visible-xs\"\n      title=\"{{ 'Back' | translate }}\"\n      (click)=\"cancel()\"\n    >\n      <i c8yIcon=\"chevron-left\"></i>\n      {{ 'Back' | translate }}\n    </button>\n  </div>\n  <div class=\"flex-grow\">\n    <div class=\"card-block large-padding\">\n      <!-- SERVER NAME -->\n      <c8y-form-group class=\"m-b-8\">\n        <label>\n          {{ 'Server name' | translate }}\n        </label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          placeholder=\"{{ 'e.g. My server' | translate }}\"\n          id=\"name\"\n          name=\"name\"\n          [(ngModel)]=\"model.name\"\n          required\n        />\n        <c8y-messages>\n          <c8y-message\n            name=\"required\"\n            text=\"{{ 'Server name is required' | translate }}\"\n          ></c8y-message>\n        </c8y-messages>\n      </c8y-form-group>\n    </div>\n\n    <div class=\"card-block large-padding bg-level-2\">\n      <div class=\"tight-grid\">\n        <div class=\"col-sm-6\">\n          <label class=\"fit-w\" translate>Server connection</label>\n          <button\n            type=\"button\"\n            class=\"btn m-t-4\"\n            name=\"serverConnection\"\n            [(ngModel)]=\"targetConnectionState\"\n            (ngModelChange)=\"setServerConnection($event)\"\n            btnCheckbox\n            btnCheckboxTrue=\"1\"\n            btnCheckboxFalse=\"0\"\n          >\n            <span title=\"{{ 'Enabled' | translate }}\" [hidden]=\"targetConnectionState !== '1'\">\n              {{ 'Enabled' | translate }}\n            </span>\n            <span title=\"{{ 'Disabled' | translate }}\" [hidden]=\"targetConnectionState !== '0'\">\n              {{ 'Disabled' | translate }}\n            </span>\n          </button>\n        </div>\n        <div class=\"col-sm-6\">\n          <label translate>Connection status</label>\n          <div class=\"form-control-static\">\n            <device-status class=\"p-r-8\" [mo]=\"server\"></device-status>\n            <span>{{ connectionStatusLabel | translate }}</span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"card-block large-padding\">\n      <!-- SERVER URL-->\n      <c8y-form-group>\n        <label for=\"configServerUrl\" translate>Server URL</label>\n        <input\n          type=\"text\"\n          class=\"form-control\"\n          id=\"configServerUrl\"\n          name=\"serverUrl\"\n          [(ngModel)]=\"model.config.serverUrl\"\n          c8yDefaultValidation=\"opcuaBrowsePath\"\n          required\n        />\n      </c8y-form-group>\n\n      <!-- TIMEOUT & STATUS-CHECK-INTERVAL-->\n      <div class=\"content-flex-32\">\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.timeout\" translate>Timeout</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.timeout\"\n                name=\"timeout\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 30\"\n                [(ngModel)]=\"model.config.timeout\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n        <div class=\"col-6\">\n          <c8y-form-group>\n            <label for=\"config.statusCheckInterval\" translate>Status check interval</label>\n            <div class=\"input-group\">\n              <input\n                type=\"number\"\n                class=\"form-control\"\n                id=\"config.statusCheckInterval\"\n                name=\"statusCheckInterval\"\n                [min]=\"minIntervalNumber\"\n                placeholder=\"{{ 'e.g.' | translate }} 40\"\n                [(ngModel)]=\"model.config.statusCheckInterval\"\n                required\n              />\n              <span class=\"input-group-addon units\" translate>seconds</span>\n            </div>\n          </c8y-form-group>\n        </div>\n      </div>\n\n      <!-- SECURITY MODE -->\n      <div class=\"tight-grid\">\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <!-- NONE, SIGN, SIGN & ENCRYPT-->\n            <label for=\"config.securityMode\" translate>Security mode</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                class=\"form-control\"\n                id=\"config.securityMode\"\n                [(ngModel)]=\"currentSecMode\"\n                (ngModelChange)=\"setPolicy($event)\"\n                name=\"securityMode\"\n                required\n              >\n                <option *ngFor=\"let mode of securityModes\" [ngValue]=\"mode\">{{ mode }}</option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode === NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.securityPolicy\"\n              name=\"securityPolicy\"\n              [readonly]=\"true\"\n              [(ngModel)]=\"model.config.securityMode\"\n              required\n            />\n          </div>\n        </div>\n        <div *ngIf=\"currentSecMode !== NONE\" class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.securityPolicy\" translate>Security policy</label>\n            <div class=\"c8y-select-wrapper\">\n              <select\n                *ngIf=\"currentSecMode === SIGN\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <select\n                *ngIf=\"currentSecMode === SIGN_ENC\"\n                class=\"form-control\"\n                id=\"config.securityPolicy\"\n                [(ngModel)]=\"model.config.securityMode\"\n                name=\"securityPolicy\"\n                required\n              >\n                <option *ngFor=\"let policy of securityPolicies.sign_enc\" [ngValue]=\"policy\">\n                  {{ policy }}\n                </option>\n              </select>\n              <span></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <!-- AUTHENTICATION -->\n      <div class=\"form-group\">\n        <label for=\"config.authenticationMode\" translate>Authentication</label>\n        <div class=\"c8y-select-wrapper\">\n          <select\n            class=\"form-control\"\n            id=\"config.authenticationMode\"\n            [(ngModel)]=\"authenticationMode\"\n            name=\"authenticationMode\"\n            (ngModelChange)=\"updateAuthentication($event)\"\n            required\n          >\n            <option *ngFor=\"let auth of authenticationModes\" [ngValue]=\"auth\">\n              {{ auth.value | translate }}\n            </option>\n          </select>\n          <span></span>\n        </div>\n      </div>\n\n      <!-- User/Pw-->\n      <div *ngIf=\"authenticationMode.id === 2\" class=\"tight-grid\">\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"config.userName\" translate>Username</label>\n            <input\n              type=\"text\"\n              class=\"form-control\"\n              id=\"config.userName\"\n              name=\"userName\"\n              placeholder=\"{{ 'e.g. joe.doe`LOCALIZE`' | translate }}\"\n              [(ngModel)]=\"model.config.userName\"\n              autocomplete=\"new-password\"\n              required\n            />\n          </div>\n        </div>\n        <!-- change password section BEGINS-->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\" *ngIf=\"!initialPasswordRequired\">\n            <button type=\"button\" class=\"btn btn-default\" (click)=\"toggleChangePassword()\">\n              <ng-container *ngIf=\"!changePassword\">\n                {{ 'Change password' | translate }}\n              </ng-container>\n              <ng-container *ngIf=\"changePassword\">\n                {{ 'Cancel password change' | translate }}\n              </ng-container>\n            </button>\n          </div>\n\n          <div class=\"form-group\">\n            <div *ngIf=\"changePassword\">\n              <label for=\"config.password\" translate>Password</label>\n              <input\n                type=\"password\"\n                class=\"form-control\"\n                id=\"config.userPassword\"\n                name=\"password\"\n                [(ngModel)]=\"model.config.userPassword\"\n                autocomplete=\"new-password\"\n                required\n              />\n            </div>\n          </div>\n        </div>\n        <!-- change password section ENDS-->\n      </div>\n      <!-- Key-based -->\n      <div *ngIf=\"authenticationMode.id === 3\" class=\"tight-grid\">\n        <!-- KEYSTORE PASSWORD -->\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.keystorePass\" translate>Keystore password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.keystorePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.keystorePass\"\n              required\n            />\n          </div>\n        </div>\n        <div class=\"col-md-6\">\n          <div class=\"form-group\">\n            <label for=\"config.certificatePass\" translate>Certificate password</label>\n            <input\n              type=\"password\"\n              class=\"form-control\"\n              id=\"config.certificatePass\"\n              name=\"keystorePass\"\n              [(ngModel)]=\"model.config.certificatePass\"\n              required\n            />\n          </div>\n        </div>\n        <!-- UPLOAD KEYSTORE -->\n        <div class=\"col-md-12\">\n          <div class=\"form-group\">\n            <label for=\"certificateUpload\" translate>Upload keystore</label>\n            <input\n              type=\"text\"\n              [readonly]=\"true\"\n              name=\"certificateUpload\"\n              class=\"form-control m-b-8\"\n              [ngModel]=\"fileName\"\n              placeholder=\"{{ 'e.g.' | translate }} yourKeystore.jks\"\n              required\n            />\n            <c8y-drop-area\n              (dropped)=\"uploadFile($event)\"\n              [loadingMessage]=\"'Importing, please wait.' | translate\"\n              [title]=\"'Import keystore with jks file extension' | translate\"\n            ></c8y-drop-area>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer large-padding separator sticky-bottom\">\n    <button\n      title=\"{{ 'Cancel' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-default\"\n      (click)=\"cancel()\"\n    >\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Remove' | translate }}\"\n      type=\"button\"\n      class=\"btn btn-danger\"\n      (click)=\"remove()\"\n    >\n      {{ 'Remove' | translate }}\n    </button>\n    <button\n      title=\"{{ 'Save' | translate }}\"\n      type=\"submit\"\n      class=\"btn btn-primary\"\n      (click)=\"save()\"\n      [disabled]=\"!opcuaConfigForm.valid\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n" }]
        }], ctorParameters: function () { return [{ type: i1.OpcuaService }]; }, propDecorators: { opcuaConfigForm: [{
                type: ViewChild,
                args: ['opcuaConfigForm', { static: false }]
            }], dropArea: [{
                type: ViewChild,
                args: [DropAreaComponent, { static: false }]
            }], canceled: [{
                type: Output
            }], removed: [{
                type: Output
            }], saved: [{
                type: Output
            }], server: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BjdWEtc2VydmVyLWNvbmZpZy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9wcm90b2NvbC1vcGN1YS9vcGN1YS1zZXJ2ZXItY29uZmlnLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uL3Byb3RvY29sLW9wY3VhL29wY3VhLXNlcnZlci1jb25maWcuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxLQUFLLEVBRUwsTUFBTSxFQUNOLFlBQVksRUFFWixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE9BQU8sRUFBZSxpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRTlFLE9BQU8sRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQzNDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7OztBQU05QyxNQUFNLE9BQU8sMEJBQTBCO0lBMkVyQyxZQUFZLFlBQTBCO1FBekV0QyxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsMEJBQXFCLEdBQUcsR0FBRyxDQUFDO1FBQzVCLHNCQUFpQixHQUFHLENBQUMsQ0FBQztRQUN0QiwwQkFBcUIsR0FBRyxFQUFFLENBQUM7UUFHakIsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUFDM0MsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUFDMUMsVUFBSyxHQUFHLElBQUksWUFBWSxFQUFlLENBQUM7UUF5QmxELG1CQUFjLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLDRCQUF1QixHQUFHLElBQUksQ0FBQztRQUkvQixTQUFJLEdBQUcsTUFBTSxDQUFDO1FBQ2QsU0FBSSxHQUFHLE1BQU0sQ0FBQztRQUNkLGFBQVEsR0FBRyxjQUFjLENBQUM7UUFDMUIscUJBQWdCLEdBQVE7WUFDdEIsSUFBSSxFQUFFLENBQUMsWUFBWSxJQUFJ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LE1BQU07WUFFUixLQUFLLGFBQWE7Z0JBQ2hCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUN6QyxNQUFNO1lBRVI7Z0JBQ0UsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQ3RDLE1BQU07U0FDVDtJQUNILENBQUM7SUFFTyxjQUFjLENBQUMsUUFBZ0I7UUFDckMsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO1lBQ25DLElBQUksUUFBUSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNuQyxPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7YUFDeEY7U0FDRjtRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7O3VIQW5WVSwwQkFBMEI7MkdBQTFCLDBCQUEwQiwrU0FPMUIsaUJBQWlCLHFFQ3pCOUIsb3FZQTBWQTsyRkR4VWEsMEJBQTBCO2tCQUp0QyxTQUFTOytCQUNFLHFCQUFxQjttR0FTa0IsZUFBZTtzQkFBL0QsU0FBUzt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7Z0JBQ0UsUUFBUTtzQkFBeEQsU0FBUzt1QkFBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7Z0JBQ3JDLFFBQVE7c0JBQWpCLE1BQU07Z0JBQ0csT0FBTztzQkFBaEIsTUFBTTtnQkFDRyxLQUFLO3NCQUFkLE1BQU07Z0JBQ00sTUFBTTtzQkFBbEIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE9uSW5pdCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIE9uQ2hhbmdlcyxcbiAgVmlld0NoaWxkXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgZ2V0dGV4dCwgRHJvcHBlZEZpbGUsIERyb3BBcmVhQ29tcG9uZW50IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBPcGN1YVNlcnZlciwgT3BjdWFTZXJ2ZXJDb25maWcgfSBmcm9tICcuL29wY3VhLXNlcnZlci5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgY2xvbmVEZWVwLCBoYXMgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgT3BjdWFTZXJ2aWNlIH0gZnJvbSAnLi9vcGN1YVNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdvcGN1YS1zZXJ2ZXItY29uZmlnJyxcbiAgdGVtcGxhdGVVcmw6ICcuL29wY3VhLXNlcnZlci1jb25maWcuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIE9wY3VhU2VydmVyQ29uZmlnQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBjdXJyZW50U2VjTW9kZTogc3RyaW5nO1xuICBmaWxlTmFtZSA9ICcnO1xuICB0YXJnZXRDb25uZWN0aW9uU3RhdGUgPSAnMSc7XG4gIG1pbkludGVydmFsTnVtYmVyID0gMTtcbiAgY29ubmVjdGlvblN0YXR1c0xhYmVsID0gJyc7XG4gIEBWaWV3Q2hpbGQoJ29wY3VhQ29uZmlnRm9ybScsIHsgc3RhdGljOiBmYWxzZSB9KSBvcGN1YUNvbmZpZ0Zvcm06IGFueTtcbiAgQFZpZXdDaGlsZChEcm9wQXJlYUNvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pIGRyb3BBcmVhOiBEcm9wQXJlYUNvbXBvbmVudDtcbiAgQE91dHB1dCgpIGNhbmNlbGVkID0gbmV3IEV2ZW50RW1pdHRlcjxPcGN1YVNlcnZlcj4oKTtcbiAgQE91dHB1dCgpIHJlbW92ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPE9wY3VhU2VydmVyPigpO1xuICBAT3V0cHV0KCkgc2F2ZWQgPSBuZXcgRXZlbnRFbWl0dGVyPE9wY3VhU2VydmVyPigpO1xuICBASW5wdXQoKSBzZXQgc2VydmVyKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICB0aGlzLl9zZXJ2ZXIgPSBjbG9uZURlZXAoc2VydmVyKTtcbiAgICBpZiAoc2VydmVyKSB7XG4gICAgICB0aGlzLm1vZGVsID0gY2xvbmVEZWVwKHNlcnZlcik7XG4gICAgICB0aGlzLmZpbGVOYW1lID0gdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVGaWxlbmFtZTtcblxuICAgICAgaWYgKHNlcnZlci5pZCAmJiBzZXJ2ZXIuaWQgPT09ICduZXcnKSB7XG4gICAgICAgIC8vIGVuYWJsZWQgY29ubmVjdGlvbiBzdGF0ZVxuICAgICAgICB0aGlzLnRhcmdldENvbm5lY3Rpb25TdGF0ZSA9ICcxJztcbiAgICAgICAgdGhpcy5tb2RlbC5jb25maWcudGFyZ2V0Q29ubmVjdGlvblN0YXRlID0gJ2VuYWJsZWQnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy50YXJnZXRDb25uZWN0aW9uU3RhdGUgPVxuICAgICAgICAgIHRoaXMubW9kZWwuY29uZmlnLnRhcmdldENvbm5lY3Rpb25TdGF0ZSA9PT0gJ2VuYWJsZWQnID8gJzEnIDogJzAnO1xuICAgICAgfVxuICAgICAgdGhpcy51cGRhdGVDb25uZWN0aW9uU3RhdHVzTGFiZWwodGhpcy5fc2VydmVyKTtcbiAgICAgIHRoaXMuc2V0TmV3UGFzc3dvcmQoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgc2VydmVyKCk6IE9wY3VhU2VydmVyIHtcbiAgICByZXR1cm4gdGhpcy5fc2VydmVyO1xuICB9XG5cbiAgbW9kZWw6IE9wY3VhU2VydmVyO1xuICBjaGFuZ2VQYXNzd29yZCA9IGZhbHNlO1xuICBpbml0aWFsUGFzc3dvcmRSZXF1aXJlZCA9IHRydWU7XG4gIHNlY3VyaXR5TW9kZXM6IHN0cmluZ1tdO1xuICBhdXRoZW50aWNhdGlvbk1vZGU6IGFueTtcbiAgYXV0aGVudGljYXRpb25Nb2RlczogYW55W107XG4gIE5PTkUgPSAnTk9ORSc7XG4gIFNJR04gPSAnU0lHTic7XG4gIFNJR05fRU5DID0gJ1NJR05fRU5DUllQVCc7XG4gIHNlY3VyaXR5UG9saWNpZXM6IGFueSA9IHtcbiAgICBzaWduOiBbYEJBU0lDMjU2XyR7dGhpcy5TSUdOfWAsIGBCQVNJQzEyOFJTQTE1XyR7dGhpcy5TSUdOfWAsIGBCQVNJQzI1NlNIQTI1Nl8ke3RoaXMuU0lHTn1gXSxcbiAgICBzaWduX2VuYzogW1xuICAgICAgYEJBU0lDMjU2XyR7dGhpcy5TSUdOX0VOQ31gLFxuICAgICAgYEJBU0lDMTI4UlNBMTVfJHt0aGlzLlNJR05fRU5DfWAsXG4gICAgICBgQkFTSUMyNTZTSEEyNTZfJHt0aGlzLlNJR05fRU5DfWBcbiAgICBdXG4gIH07XG4gIHByaXZhdGUgQU5PTllNID0ge1xuICAgIGlkOiAxLFxuICAgIHZhbHVlOiBnZXR0ZXh0KCdBbm9ueW1vdXMnKVxuICB9O1xuICBwcml2YXRlIFVTRVJfUEFTU1dPUkQgPSB7XG4gICAgaWQ6IDIsXG4gICAgdmFsdWU6IGdldHRleHQoJ1VzZXJuYW1lL1Bhc3N3b3JkJylcbiAgfTtcbiAgcHJpdmF0ZSBLRVlfQkFTRUQgPSB7XG4gICAgaWQ6IDMsXG4gICAgdmFsdWU6IGdldHRleHQoJ0tleS1iYXNlZCBBdXRoZW50aWNhdGlvbicpXG4gIH07XG4gIHByaXZhdGUgX3NlcnZlcjogT3BjdWFTZXJ2ZXI7XG4gIHByaXZhdGUgb3BjdWFTZXJ2aWNlOiBPcGN1YVNlcnZpY2U7XG4gIHByaXZhdGUgaW5pdGlhbEtleXN0b3JlID0ge1xuICAgIGxhc3RNb2RpZmllZDogMCxcbiAgICBuYW1lOiAnJyxcbiAgICB0eXBlOiAnJyxcbiAgICBzbGljZTogbnVsbCxcbiAgICBzaXplOiAwXG4gIH0gYXMgRmlsZTtcbiAgcHJpdmF0ZSBrZXlzdG9yZTogRmlsZSA9IHRoaXMuaW5pdGlhbEtleXN0b3JlO1xuICBwcml2YXRlIGF1dGhTd2l0Y2ggPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihvcGN1YVNlcnZpY2U6IE9wY3VhU2VydmljZSkge1xuICAgIHRoaXMub3BjdWFTZXJ2aWNlID0gb3BjdWFTZXJ2aWNlO1xuICB9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5hdXRoU3dpdGNoID0gZmFsc2U7XG5cbiAgICB0aGlzLnNlY3VyaXR5TW9kZXMgPSBbdGhpcy5OT05FLCB0aGlzLlNJR04sIHRoaXMuU0lHTl9FTkNdO1xuXG4gICAgdGhpcy5hdXRoZW50aWNhdGlvbk1vZGVzID0gW3RoaXMuQU5PTllNLCB0aGlzLlVTRVJfUEFTU1dPUkQsIHRoaXMuS0VZX0JBU0VEXTtcblxuICAgIHRoaXMuc2V0Q3VycmVudEF1dGhlbnRpY2F0aW9uTW9kZSgpO1xuICAgIHRoaXMuc2V0Q3VycmVudFNlY3VyaXR5TW9kZSgpO1xuICB9XG5cbiAgbmdPbkNoYW5nZXMoKSB7XG4gICAgdGhpcy5zZXRDdXJyZW50U2VjdXJpdHlNb2RlKCk7XG4gICAgdGhpcy5zZXRDdXJyZW50QXV0aGVudGljYXRpb25Nb2RlKCk7XG4gIH1cblxuICBjYW5jZWwoKSB7XG4gICAgdGhpcy5jYW5jZWxlZC5lbWl0KHRoaXMubW9kZWwpO1xuICAgIHRoaXMuX3NlcnZlciA9IG51bGw7XG4gIH1cblxuICBhc3luYyByZW1vdmUoKSB7XG4gICAgYXdhaXQgdGhpcy5yZW1vdmVLZXlzdG9yZSh0aGlzLm1vZGVsKTtcbiAgICB0aGlzLnJlbW92ZWQuZW1pdCh0aGlzLm1vZGVsKTtcbiAgICB0aGlzLl9zZXJ2ZXIgPSBudWxsO1xuICB9XG5cbiAgYXN5bmMgc2F2ZSgpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLmtleXN0b3JlICYmXG4gICAgICB0aGlzLmtleXN0b3JlLnNpemUgPiAwICYmXG4gICAgICB0aGlzLmtleXN0b3JlLm5hbWUgJiZcbiAgICAgIHRoaXMua2V5c3RvcmUubmFtZS5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMudXBsb2FkS2V5c3RvcmUodGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVCaW5hcnlJZCk7XG5cbiAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuaWQpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVCaW5hcnlJZCA9IHJlc3BvbnNlLmRhdGEuaWQ7XG4gICAgICB9XG5cbiAgICAgIC8vIGlmIHRoZSBrZXlzdG9yZSB3YXMgdXBsb2FkZWQgc3VjY2Vzc2Z1bCB3ZSBjYW4gcmVtb3ZlXG4gICAgICAvLyB0aGUgbG9jYWwga2V5c3RvcmUuIFRoaXMgd2lsbCBwcmV2ZW50IGFub3RoZXIgcmVxdWVzdCB0byBiaW5hcnkgYXBpXG4gICAgICAvLyB3aGVuIHRoZSB1c2VyIHdpbGwgZWRpdCBvdGhlciBpbnB1dHMgaW4gdGhlIGZvcm0gYW5kIGhpdCBzYXZlIGFnYWluLlxuICAgICAgdGhpcy5rZXlzdG9yZSA9IHRoaXMuaW5pdGlhbEtleXN0b3JlO1xuICAgIH1cblxuICAgIC8vIHdpbGwgcmVtb3ZlIGtleXN0b3JlIChiaW5hcnkpIHdoZW4gdGhlIHVzZXIgc3dpdGNoZWRcbiAgICAvLyBhdXRoZW50aWNhdGlvbiBzZXR0aW5ncyBmcm9tIGtleS1iYXNlZCB0byBhbm9ueW1vdXMgb3IgdXNlcm5hbWUvcGFzc3dvcmRcbiAgICBpZiAodGhpcy5hdXRoU3dpdGNoKSB7XG4gICAgICB0aGlzLnJlbW92ZUtleXN0b3JlKHRoaXMuc2VydmVyKTtcbiAgICB9XG5cbiAgICAvLyB3aGVuIHRoZSB1c2VyIHNldHMgYSBuZXcgcGFzc3dvcmQsIG1ha2Ugc3VyZSB0byBtYXJrIGl0IGFzXG4gICAgLy8gXCJub3QgZW5jcnlwdGVkXCIgYnkgc2V0dGluZyBwYXNzd29yZEVuY3J5cHRlZCB0byBmYWxzZVxuICAgIGNvbnN0IHVzZXJQYXNzd29yZDogc3RyaW5nID0gdGhpcy5nZXRNb2RlbENvbmZpZygndXNlclBhc3N3b3JkJyk7XG4gICAgaWYgKHVzZXJQYXNzd29yZCAmJiB1c2VyUGFzc3dvcmQubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5tb2RlbC5jb25maWcucGFzc3dvcmRFbmNyeXB0ZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLnNhdmVkLmVtaXQodGhpcy5tb2RlbCk7XG4gIH1cblxuICB1cGxvYWRGaWxlKGRyb3BwZWRGaWxlczogRHJvcHBlZEZpbGVbXSkge1xuICAgIGlmIChkcm9wcGVkRmlsZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICB0aGlzLmtleXN0b3JlID0gZHJvcHBlZEZpbGVzWzBdLmZpbGU7XG4gICAgICB0aGlzLmZpbGVOYW1lID0gdGhpcy5rZXlzdG9yZS5uYW1lO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBkcm9wcGVkIG1vcmUgdGhhbiBvbmUgZmlsZVxuICAgICAgY29uc29sZS53YXJuKCdUcmllZCB0byBpbXBvcnQuLi4gSW1wb3J0IGFib3J0ZWQuJyk7XG4gICAgfVxuICB9XG5cbiAgc2V0UG9saWN5KGRhdGE6IGFueSkge1xuICAgIGlmIChkYXRhID09PSB0aGlzLk5PTkUpIHtcbiAgICAgIHRoaXMubW9kZWwuY29uZmlnLnNlY3VyaXR5TW9kZSA9IHRoaXMuTk9ORTtcbiAgICB9IGVsc2UgaWYgKGRhdGEgPT09IHRoaXMuU0lHTikge1xuICAgICAgdGhpcy5tb2RlbC5jb25maWcuc2VjdXJpdHlNb2RlID0gdGhpcy5zZWN1cml0eVBvbGljaWVzLnNpZ25bMF07XG4gICAgfSBlbHNlIGlmIChkYXRhID09PSB0aGlzLlNJR05fRU5DKSB7XG4gICAgICB0aGlzLm1vZGVsLmNvbmZpZy5zZWN1cml0eU1vZGUgPSB0aGlzLnNlY3VyaXR5UG9saWNpZXMuc2lnbl9lbmNbMF07XG4gICAgfVxuICB9XG5cbiAgc2V0U2VydmVyQ29ubmVjdGlvbihkYXRhOiBzdHJpbmcpIHtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy50YXJnZXRDb25uZWN0aW9uU3RhdGUgPSBkYXRhICE9PSAnMCcgPyAnZW5hYmxlZCcgOiAnZGlzYWJsZWQnO1xuICB9XG5cbiAgdXBkYXRlQXV0aGVudGljYXRpb24oZGF0YTogYW55KSB7XG4gICAgaWYgKGRhdGEgJiYgZGF0YS5pZCkge1xuICAgICAgc3dpdGNoIChkYXRhLmlkKSB7XG4gICAgICAgIC8vIEFub255bW91c1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgdGhpcy5yZXNldFVzZXJBdXRoZW50aWNhdGlvbigpO1xuICAgICAgICAgIHRoaXMucmVzZXRLZXlCYXNlZEF1dGhlbnRpY2F0aW9uKCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgLy8gVXNlci9QYXNzd29yZFxuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgdGhpcy5yZXNldEtleUJhc2VkQXV0aGVudGljYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnJlc3RvcmVVc2VyRGF0YSgpO1xuICAgICAgICAgIHRoaXMuc2V0TmV3UGFzc3dvcmQoKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICAvLyBLZXktYmFzZWRcbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgIHRoaXMucmVzZXRVc2VyQXV0aGVudGljYXRpb24oKTtcbiAgICAgICAgICB0aGlzLnJlc3RvcmVLZXlCYXNlZERhdGEoKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIGNvbnNvbGUud2FybignSW52YWxpZCBhdXRoZW50aWNhdGlvbiBpZCcsIGRhdGEuaWQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUNvbm5lY3Rpb25TdGF0dXNMYWJlbChzZXJ2ZXIpIHtcbiAgICBjb25zdCBjb25uZWN0ZWQgPSBzZXJ2ZXIuYzh5X0Nvbm5lY3Rpb24gJiYgc2VydmVyLmM4eV9Db25uZWN0aW9uLnN0YXR1cyA9PT0gJ0NPTk5FQ1RFRCc7XG4gICAgY29uc3QgbGFiZWwgPSBjb25uZWN0ZWQgPyBnZXR0ZXh0KCdDb25uZWN0ZWQnKSA6IGdldHRleHQoJ0Rpc2Nvbm5lY3RlZCcpO1xuICAgIHRoaXMuY29ubmVjdGlvblN0YXR1c0xhYmVsID0gbGFiZWw7XG4gIH1cblxuICBzZXROZXdQYXNzd29yZCgpIHtcbiAgICBjb25zdCB1c2VybmFtZTogc3RyaW5nID0gdGhpcy5nZXRNb2RlbENvbmZpZygndXNlck5hbWUnKTtcbiAgICBpZiAodXNlcm5hbWUgJiYgdXNlcm5hbWUubGVuZ3RoID4gMCkge1xuICAgICAgLy8gdXNlck5hbWUgaXMgZ2l2ZW4sIE5PIG5lZWQgdG8gY2hhbmdlIHRoZSBwYXNzd29yZCBiZWNhdXNlIGl0IGlzIGFscmVhZHkgc2V0XG4gICAgICB0aGlzLmNoYW5nZVBhc3N3b3JkID0gZmFsc2U7XG4gICAgICB0aGlzLmluaXRpYWxQYXNzd29yZFJlcXVpcmVkID0gZmFsc2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG5vIHVzZXJOYW1lIGluIHJlc3BvbnNlLCBzbyByZXF1aXJlIHRoZSB1c2VyIHRvIHNldCB0aGUgaW5pdGlhbCBwd1xuICAgICAgdGhpcy5jaGFuZ2VQYXNzd29yZCA9IHRydWU7XG4gICAgICB0aGlzLmluaXRpYWxQYXNzd29yZFJlcXVpcmVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICB0b2dnbGVDaGFuZ2VQYXNzd29yZCgpIHtcbiAgICB0aGlzLmNoYW5nZVBhc3N3b3JkID0gIXRoaXMuY2hhbmdlUGFzc3dvcmQ7XG4gICAgLy8gV2hlbiB0aGUgdXNlciBoaWRlcyB0aGUgcHctaW5wdXQgZmllbGQgYnV0IGhhcyBlbnRlcmVkIGFcbiAgICAvLyBzdHJpbmcgdG8gaXQgYmVmb3JlLCB3ZSBuZWVkIHRvIGRpc2NhcmQgdGhlIGNoYW5nZXMgcmVmbGVjdGVkIGluIHRoZSBtb2RlbFxuICAgIC8vIG90aGVyd2lzZSB3ZSBQVVQgaXQgd2l0aCB0aGUgbW9kZWwgd2hlbiB1c2VyIGhpdHMgdGhlIHNhdmUgYnV0dG9uXG4gICAgaWYgKCF0aGlzLmNoYW5nZVBhc3N3b3JkKSB7XG4gICAgICBpZiAodGhpcy5nZXRNb2RlbENvbmZpZygndXNlclBhc3N3b3JkJykpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMubW9kZWwuY29uZmlnLnVzZXJQYXNzd29yZDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwbG9hZEtleXN0b3JlKGJpbmFyeUlkPzogc3RyaW5nKSB7XG4gICAgaWYgKCFiaW5hcnlJZCkge1xuICAgICAgcmV0dXJuIHRoaXMub3BjdWFTZXJ2aWNlLnVwbG9hZEtleXN0b3JlKHRoaXMua2V5c3RvcmUpO1xuICAgIH0gZWxzZSBpZiAoYmluYXJ5SWQgJiYgYmluYXJ5SWQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gdXBkYXRlIGV4aXN0aW5nIGJpbmFyeVxuICAgICAgcmV0dXJuIHRoaXMub3BjdWFTZXJ2aWNlLnVwZGF0ZUtleXN0b3JlKGJpbmFyeUlkLCB0aGlzLmtleXN0b3JlKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUtleXN0b3JlKHNlcnZlcjogT3BjdWFTZXJ2ZXIpIHtcbiAgICBpZiAoXG4gICAgICBzZXJ2ZXIgJiZcbiAgICAgIHNlcnZlci5jb25maWcgJiZcbiAgICAgIHNlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZCAmJlxuICAgICAgc2VydmVyLmNvbmZpZy5rZXlzdG9yZUJpbmFyeUlkLmxlbmd0aCA+IDBcbiAgICApIHtcbiAgICAgIHRoaXMuYXV0aFN3aXRjaCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHRoaXMub3BjdWFTZXJ2aWNlLnJlbW92ZUtleXN0b3JlKHRoaXMuc2VydmVyLmNvbmZpZy5rZXlzdG9yZUJpbmFyeUlkKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc2V0VXNlckF1dGhlbnRpY2F0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuY29uZmlnLnVzZXJOYW1lID0gbnVsbDtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VyUGFzc3dvcmQgPSBudWxsO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLnVzZXJJZGVudGl0eU1vZGUgPSAnbm9uZSc7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0S2V5QmFzZWRBdXRoZW50aWNhdGlvbigpIHtcbiAgICB0aGlzLmF1dGhTd2l0Y2ggPSB0cnVlO1xuXG4gICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVQYXNzID0gbnVsbDtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy5jZXJ0aWZpY2F0ZVBhc3MgPSBudWxsO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLmtleXN0b3JlQmluYXJ5SWQgPSAnJztcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy5rZXlzdG9yZUZpbGVuYW1lID0gJyc7XG4gICAgdGhpcy5tb2RlbC5jb25maWcudXNlcklkZW50aXR5TW9kZSA9ICdub25lJztcbiAgfVxuXG4gIHByaXZhdGUgcmVzdG9yZVVzZXJEYXRhKCkge1xuICAgIHRoaXMubW9kZWwuY29uZmlnLnVzZXJOYW1lID0gdGhpcy5fc2VydmVyLmNvbmZpZy51c2VyTmFtZTtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy51c2VySWRlbnRpdHlNb2RlID0gJ3VzZXJBbmRQYXNzd29yZCc7XG4gIH1cblxuICBwcml2YXRlIHJlc3RvcmVLZXlCYXNlZERhdGEoKSB7XG4gICAgdGhpcy5hdXRoU3dpdGNoID0gZmFsc2U7XG4gICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVQYXNzID0gdGhpcy5fc2VydmVyLmNvbmZpZy5rZXlzdG9yZVBhc3M7XG4gICAgdGhpcy5tb2RlbC5jb25maWcuY2VydGlmaWNhdGVQYXNzID0gdGhpcy5fc2VydmVyLmNvbmZpZy5jZXJ0aWZpY2F0ZVBhc3M7XG4gICAgdGhpcy5tb2RlbC5jb25maWcua2V5c3RvcmVCaW5hcnlJZCA9IHRoaXMuX3NlcnZlci5jb25maWcua2V5c3RvcmVCaW5hcnlJZDtcbiAgICB0aGlzLm1vZGVsLmNvbmZpZy5rZXlzdG9yZUZpbGVuYW1lID0gdGhpcy5fc2VydmVyLmNvbmZpZy5rZXlzdG9yZUZpbGVuYW1lO1xuICAgIHRoaXMubW9kZWwuY29uZmlnLnVzZXJJZGVudGl0eU1vZGUgPSAnY2VydGlmaWNhdGUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXJ2ZXJDb25maWcoKTogT3BjdWFTZXJ2ZXJDb25maWcge1xuICAgIGxldCBjZmc6IE9wY3VhU2VydmVyQ29uZmlnID0ge1xuICAgICAgc2VjdXJpdHlNb2RlOiB0aGlzLk5PTkUsXG4gICAgICB1c2VySWRlbnRpdHlNb2RlOiAnbm9uZSdcbiAgICB9O1xuICAgIGlmICh0aGlzLnNlcnZlciAmJiB0aGlzLnNlcnZlci5jb25maWcpIHtcbiAgICAgIGNmZyA9IHRoaXMuc2VydmVyLmNvbmZpZztcbiAgICB9XG4gICAgcmV0dXJuIGNmZztcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q3VycmVudFNlY3VyaXR5TW9kZSgpIHtcbiAgICBjb25zdCB7IHNlY3VyaXR5TW9kZSB9ID0gdGhpcy5nZXRTZXJ2ZXJDb25maWcoKTtcbiAgICBpZiAoc2VjdXJpdHlNb2RlKSB7XG4gICAgICBjb25zdCBmb3VuZEluU2lnbiA9IHRoaXMuc2VjdXJpdHlQb2xpY2llcy5zaWduLmZpbmQoZWwgPT4gZWwgPT09IHNlY3VyaXR5TW9kZSk7XG4gICAgICBpZiAoZm91bmRJblNpZ24pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2VjTW9kZSA9IHRoaXMuU0lHTjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IGZvdW5kSW5TaWduRW5jcnlwdCA9IHRoaXMuc2VjdXJpdHlQb2xpY2llcy5zaWduX2VuYy5maW5kKGVsID0+IGVsID09PSBzZWN1cml0eU1vZGUpO1xuICAgICAgICBmb3VuZEluU2lnbkVuY3J5cHRcbiAgICAgICAgICA/ICh0aGlzLmN1cnJlbnRTZWNNb2RlID0gdGhpcy5TSUdOX0VOQylcbiAgICAgICAgICA6ICh0aGlzLmN1cnJlbnRTZWNNb2RlID0gdGhpcy5OT05FKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEN1cnJlbnRBdXRoZW50aWNhdGlvbk1vZGUoKSB7XG4gICAgY29uc3QgeyB1c2VySWRlbnRpdHlNb2RlIH0gPSB0aGlzLmdldFNlcnZlckNvbmZpZygpO1xuXG4gICAgc3dpdGNoICh1c2VySWRlbnRpdHlNb2RlKSB7XG4gICAgICBjYXNlICdjZXJ0aWZpY2F0ZSc6XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25Nb2RlID0gdGhpcy5LRVlfQkFTRUQ7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICd1c2VyQW5kUGFzc3dvcmQnOlxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uTW9kZSA9IHRoaXMuVVNFUl9QQVNTV09SRDtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgJ0Fub255bW91cyc6XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25Nb2RlID0gdGhpcy5BTk9OWU07XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlICdVc2VyTmFtZSc6XG4gICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25Nb2RlID0gdGhpcy5VU0VSX1BBU1NXT1JEO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAnQ2VydGlmaWNhdGUnOlxuICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uTW9kZSA9IHRoaXMuS0VZX0JBU0VEO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvbk1vZGUgPSB0aGlzLkFOT05ZTTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRNb2RlbENvbmZpZyhmcmFnbWVudDogc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMubW9kZWwgJiYgdGhpcy5tb2RlbC5jb25maWcpIHtcbiAgICAgIGlmIChmcmFnbWVudCAmJiBmcmFnbWVudC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiBoYXModGhpcy5tb2RlbC5jb25maWcsIGZyYWdtZW50KSA/IHRoaXMubW9kZWwuY29uZmlnW2Ake2ZyYWdtZW50fWBdIDogdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iLCI8ZGl2IGNsYXNzPVwiYzh5LWVtcHR5LXN0YXRlIG0tdC00XCIgKm5nSWY9XCIhc2VydmVyXCI+XG4gIDxoMSBjbGFzcz1cImM4eS1pY29uIGM4eS1pY29uLWR1b2NvbG9yXCIgYzh5SWNvbj1cInNlcnZlclwiPjwvaDE+XG4gIDxkaXY+XG4gICAgPHAgY2xhc3M9XCJ0ZXh0LW1lZGl1bVwiPnt7ICdObyBzZXJ2ZXIgdG8gZGlzcGxheS4nIHwgdHJhbnNsYXRlIH19PC9wPlxuICAgIDxwPnt7ICdBZGQgb3Igc2VsZWN0IGEgc2VydmVyLicgfCB0cmFuc2xhdGUgfX08L3A+XG4gIDwvZGl2PlxuPC9kaXY+XG5cbjxmb3JtICNvcGN1YUNvbmZpZ0Zvcm09XCJuZ0Zvcm1cIiBjbGFzcz1cImQtY29udGVudHNcIiAqbmdJZj1cInNlcnZlclwiPlxuICA8ZGl2IGNsYXNzPVwiY2FyZC1oZWFkZXIgbGFyZ2UtcGFkZGluZyBzZXBhcmF0b3Igc3RpY2t5LXRvcCB2aXNpYmxlLXNtIHZpc2libGUteHNcIj5cbiAgICA8YnV0dG9uXG4gICAgICBjbGFzcz1cImJ0biBidG4tY2xlYW4gdGV4dC1wcmltYXJ5IHZpc2libGUtc20gdmlzaWJsZS14c1wiXG4gICAgICB0aXRsZT1cInt7ICdCYWNrJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAoY2xpY2spPVwiY2FuY2VsKClcIlxuICAgID5cbiAgICAgIDxpIGM4eUljb249XCJjaGV2cm9uLWxlZnRcIj48L2k+XG4gICAgICB7eyAnQmFjaycgfCB0cmFuc2xhdGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJmbGV4LWdyb3dcIj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ibG9jayBsYXJnZS1wYWRkaW5nXCI+XG4gICAgICA8IS0tIFNFUlZFUiBOQU1FIC0tPlxuICAgICAgPGM4eS1mb3JtLWdyb3VwIGNsYXNzPVwibS1iLThcIj5cbiAgICAgICAgPGxhYmVsPlxuICAgICAgICAgIHt7ICdTZXJ2ZXIgbmFtZScgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICBwbGFjZWhvbGRlcj1cInt7ICdlLmcuIE15IHNlcnZlcicgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgICAgIGlkPVwibmFtZVwiXG4gICAgICAgICAgbmFtZT1cIm5hbWVcIlxuICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwubmFtZVwiXG4gICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgLz5cbiAgICAgICAgPGM4eS1tZXNzYWdlcz5cbiAgICAgICAgICA8Yzh5LW1lc3NhZ2VcbiAgICAgICAgICAgIG5hbWU9XCJyZXF1aXJlZFwiXG4gICAgICAgICAgICB0ZXh0PVwie3sgJ1NlcnZlciBuYW1lIGlzIHJlcXVpcmVkJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICAgICAgPjwvYzh5LW1lc3NhZ2U+XG4gICAgICAgIDwvYzh5LW1lc3NhZ2VzPlxuICAgICAgPC9jOHktZm9ybS1ncm91cD5cbiAgICA8L2Rpdj5cblxuICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJsb2NrIGxhcmdlLXBhZGRpbmcgYmctbGV2ZWwtMlwiPlxuICAgICAgPGRpdiBjbGFzcz1cInRpZ2h0LWdyaWRcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1zbS02XCI+XG4gICAgICAgICAgPGxhYmVsIGNsYXNzPVwiZml0LXdcIiB0cmFuc2xhdGU+U2VydmVyIGNvbm5lY3Rpb248L2xhYmVsPlxuICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgY2xhc3M9XCJidG4gbS10LTRcIlxuICAgICAgICAgICAgbmFtZT1cInNlcnZlckNvbm5lY3Rpb25cIlxuICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJ0YXJnZXRDb25uZWN0aW9uU3RhdGVcIlxuICAgICAgICAgICAgKG5nTW9kZWxDaGFuZ2UpPVwic2V0U2VydmVyQ29ubmVjdGlvbigkZXZlbnQpXCJcbiAgICAgICAgICAgIGJ0bkNoZWNrYm94XG4gICAgICAgICAgICBidG5DaGVja2JveFRydWU9XCIxXCJcbiAgICAgICAgICAgIGJ0bkNoZWNrYm94RmFsc2U9XCIwXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8c3BhbiB0aXRsZT1cInt7ICdFbmFibGVkJyB8IHRyYW5zbGF0ZSB9fVwiIFtoaWRkZW5dPVwidGFyZ2V0Q29ubmVjdGlvblN0YXRlICE9PSAnMSdcIj5cbiAgICAgICAgICAgICAge3sgJ0VuYWJsZWQnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8c3BhbiB0aXRsZT1cInt7ICdEaXNhYmxlZCcgfCB0cmFuc2xhdGUgfX1cIiBbaGlkZGVuXT1cInRhcmdldENvbm5lY3Rpb25TdGF0ZSAhPT0gJzAnXCI+XG4gICAgICAgICAgICAgIHt7ICdEaXNhYmxlZCcgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtc20tNlwiPlxuICAgICAgICAgIDxsYWJlbCB0cmFuc2xhdGU+Q29ubmVjdGlvbiBzdGF0dXM8L2xhYmVsPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWNvbnRyb2wtc3RhdGljXCI+XG4gICAgICAgICAgICA8ZGV2aWNlLXN0YXR1cyBjbGFzcz1cInAtci04XCIgW21vXT1cInNlcnZlclwiPjwvZGV2aWNlLXN0YXR1cz5cbiAgICAgICAgICAgIDxzcGFuPnt7IGNvbm5lY3Rpb25TdGF0dXNMYWJlbCB8IHRyYW5zbGF0ZSB9fTwvc3Bhbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwiY2FyZC1ibG9jayBsYXJnZS1wYWRkaW5nXCI+XG4gICAgICA8IS0tIFNFUlZFUiBVUkwtLT5cbiAgICAgIDxjOHktZm9ybS1ncm91cD5cbiAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZ1NlcnZlclVybFwiIHRyYW5zbGF0ZT5TZXJ2ZXIgVVJMPC9sYWJlbD5cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICBpZD1cImNvbmZpZ1NlcnZlclVybFwiXG4gICAgICAgICAgbmFtZT1cInNlcnZlclVybFwiXG4gICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcuc2VydmVyVXJsXCJcbiAgICAgICAgICBjOHlEZWZhdWx0VmFsaWRhdGlvbj1cIm9wY3VhQnJvd3NlUGF0aFwiXG4gICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgLz5cbiAgICAgIDwvYzh5LWZvcm0tZ3JvdXA+XG5cbiAgICAgIDwhLS0gVElNRU9VVCAmIFNUQVRVUy1DSEVDSy1JTlRFUlZBTC0tPlxuICAgICAgPGRpdiBjbGFzcz1cImNvbnRlbnQtZmxleC0zMlwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLTZcIj5cbiAgICAgICAgICA8Yzh5LWZvcm0tZ3JvdXA+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLnRpbWVvdXRcIiB0cmFuc2xhdGU+VGltZW91dDwvbGFiZWw+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaW5wdXQtZ3JvdXBcIj5cbiAgICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgICAgdHlwZT1cIm51bWJlclwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICAgIGlkPVwiY29uZmlnLnRpbWVvdXRcIlxuICAgICAgICAgICAgICAgIG5hbWU9XCJ0aW1lb3V0XCJcbiAgICAgICAgICAgICAgICBbbWluXT1cIm1pbkludGVydmFsTnVtYmVyXCJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cInt7ICdlLmcuJyB8IHRyYW5zbGF0ZSB9fSAzMFwiXG4gICAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcudGltZW91dFwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJpbnB1dC1ncm91cC1hZGRvbiB1bml0c1wiIHRyYW5zbGF0ZT5zZWNvbmRzPC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9jOHktZm9ybS1ncm91cD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtNlwiPlxuICAgICAgICAgIDxjOHktZm9ybS1ncm91cD5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcuc3RhdHVzQ2hlY2tJbnRlcnZhbFwiIHRyYW5zbGF0ZT5TdGF0dXMgY2hlY2sgaW50ZXJ2YWw8L2xhYmVsPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwXCI+XG4gICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgIHR5cGU9XCJudW1iZXJcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpZy5zdGF0dXNDaGVja0ludGVydmFsXCJcbiAgICAgICAgICAgICAgICBuYW1lPVwic3RhdHVzQ2hlY2tJbnRlcnZhbFwiXG4gICAgICAgICAgICAgICAgW21pbl09XCJtaW5JbnRlcnZhbE51bWJlclwiXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ7eyAnZS5nLicgfCB0cmFuc2xhdGUgfX0gNDBcIlxuICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLnN0YXR1c0NoZWNrSW50ZXJ2YWxcIlxuICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiaW5wdXQtZ3JvdXAtYWRkb24gdW5pdHNcIiB0cmFuc2xhdGU+c2Vjb25kczwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvYzh5LWZvcm0tZ3JvdXA+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDwhLS0gU0VDVVJJVFkgTU9ERSAtLT5cbiAgICAgIDxkaXYgY2xhc3M9XCJ0aWdodC1ncmlkXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8IS0tIE5PTkUsIFNJR04sIFNJR04gJiBFTkNSWVBULS0+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLnNlY3VyaXR5TW9kZVwiIHRyYW5zbGF0ZT5TZWN1cml0eSBtb2RlPC9sYWJlbD5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjOHktc2VsZWN0LXdyYXBwZXJcIj5cbiAgICAgICAgICAgICAgPHNlbGVjdFxuICAgICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgICBpZD1cImNvbmZpZy5zZWN1cml0eU1vZGVcIlxuICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVwiY3VycmVudFNlY01vZGVcIlxuICAgICAgICAgICAgICAgIChuZ01vZGVsQ2hhbmdlKT1cInNldFBvbGljeSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICBuYW1lPVwic2VjdXJpdHlNb2RlXCJcbiAgICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPG9wdGlvbiAqbmdGb3I9XCJsZXQgbW9kZSBvZiBzZWN1cml0eU1vZGVzXCIgW25nVmFsdWVdPVwibW9kZVwiPnt7IG1vZGUgfX08L29wdGlvbj5cbiAgICAgICAgICAgICAgPC9zZWxlY3Q+XG4gICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiAqbmdJZj1cImN1cnJlbnRTZWNNb2RlID09PSBOT05FXCIgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLnNlY3VyaXR5UG9saWN5XCIgdHJhbnNsYXRlPlNlY3VyaXR5IHBvbGljeTwvbGFiZWw+XG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgIGlkPVwiY29uZmlnLnNlY3VyaXR5UG9saWN5XCJcbiAgICAgICAgICAgICAgbmFtZT1cInNlY3VyaXR5UG9saWN5XCJcbiAgICAgICAgICAgICAgW3JlYWRvbmx5XT1cInRydWVcIlxuICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5zZWN1cml0eU1vZGVcIlxuICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgKm5nSWY9XCJjdXJyZW50U2VjTW9kZSAhPT0gTk9ORVwiIGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5zZWN1cml0eVBvbGljeVwiIHRyYW5zbGF0ZT5TZWN1cml0eSBwb2xpY3k8L2xhYmVsPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImM4eS1zZWxlY3Qtd3JhcHBlclwiPlxuICAgICAgICAgICAgICA8c2VsZWN0XG4gICAgICAgICAgICAgICAgKm5nSWY9XCJjdXJyZW50U2VjTW9kZSA9PT0gU0lHTlwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICAgIGlkPVwiY29uZmlnLnNlY3VyaXR5UG9saWN5XCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5zZWN1cml0eU1vZGVcIlxuICAgICAgICAgICAgICAgIG5hbWU9XCJzZWN1cml0eVBvbGljeVwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxvcHRpb24gKm5nRm9yPVwibGV0IHBvbGljeSBvZiBzZWN1cml0eVBvbGljaWVzLnNpZ25cIiBbbmdWYWx1ZV09XCJwb2xpY3lcIj5cbiAgICAgICAgICAgICAgICAgIHt7IHBvbGljeSB9fVxuICAgICAgICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgICAgICAgPHNlbGVjdFxuICAgICAgICAgICAgICAgICpuZ0lmPVwiY3VycmVudFNlY01vZGUgPT09IFNJR05fRU5DXCJcbiAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgICAgaWQ9XCJjb25maWcuc2VjdXJpdHlQb2xpY3lcIlxuICAgICAgICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLnNlY3VyaXR5TW9kZVwiXG4gICAgICAgICAgICAgICAgbmFtZT1cInNlY3VyaXR5UG9saWN5XCJcbiAgICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPG9wdGlvbiAqbmdGb3I9XCJsZXQgcG9saWN5IG9mIHNlY3VyaXR5UG9saWNpZXMuc2lnbl9lbmNcIiBbbmdWYWx1ZV09XCJwb2xpY3lcIj5cbiAgICAgICAgICAgICAgICAgIHt7IHBvbGljeSB9fVxuICAgICAgICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDwhLS0gQVVUSEVOVElDQVRJT04gLS0+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlnLmF1dGhlbnRpY2F0aW9uTW9kZVwiIHRyYW5zbGF0ZT5BdXRoZW50aWNhdGlvbjwvbGFiZWw+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjOHktc2VsZWN0LXdyYXBwZXJcIj5cbiAgICAgICAgICA8c2VsZWN0XG4gICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICBpZD1cImNvbmZpZy5hdXRoZW50aWNhdGlvbk1vZGVcIlxuICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJhdXRoZW50aWNhdGlvbk1vZGVcIlxuICAgICAgICAgICAgbmFtZT1cImF1dGhlbnRpY2F0aW9uTW9kZVwiXG4gICAgICAgICAgICAobmdNb2RlbENoYW5nZSk9XCJ1cGRhdGVBdXRoZW50aWNhdGlvbigkZXZlbnQpXCJcbiAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPG9wdGlvbiAqbmdGb3I9XCJsZXQgYXV0aCBvZiBhdXRoZW50aWNhdGlvbk1vZGVzXCIgW25nVmFsdWVdPVwiYXV0aFwiPlxuICAgICAgICAgICAgICB7eyBhdXRoLnZhbHVlIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICA8L29wdGlvbj5cbiAgICAgICAgICA8L3NlbGVjdD5cbiAgICAgICAgICA8c3Bhbj48L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDwhLS0gVXNlci9Qdy0tPlxuICAgICAgPGRpdiAqbmdJZj1cImF1dGhlbnRpY2F0aW9uTW9kZS5pZCA9PT0gMlwiIGNsYXNzPVwidGlnaHQtZ3JpZFwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTEyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcudXNlck5hbWVcIiB0cmFuc2xhdGU+VXNlcm5hbWU8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICBpZD1cImNvbmZpZy51c2VyTmFtZVwiXG4gICAgICAgICAgICAgIG5hbWU9XCJ1c2VyTmFtZVwiXG4gICAgICAgICAgICAgIHBsYWNlaG9sZGVyPVwie3sgJ2UuZy4gam9lLmRvZWBMT0NBTElaRWAnIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgICAgICAgICAgWyhuZ01vZGVsKV09XCJtb2RlbC5jb25maWcudXNlck5hbWVcIlxuICAgICAgICAgICAgICBhdXRvY29tcGxldGU9XCJuZXctcGFzc3dvcmRcIlxuICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDwhLS0gY2hhbmdlIHBhc3N3b3JkIHNlY3Rpb24gQkVHSU5TLS0+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjb2wtbWQtNlwiPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCIgKm5nSWY9XCIhaW5pdGlhbFBhc3N3b3JkUmVxdWlyZWRcIj5cbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0XCIgKGNsaWNrKT1cInRvZ2dsZUNoYW5nZVBhc3N3b3JkKClcIj5cbiAgICAgICAgICAgICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cIiFjaGFuZ2VQYXNzd29yZFwiPlxuICAgICAgICAgICAgICAgIHt7ICdDaGFuZ2UgcGFzc3dvcmQnIHwgdHJhbnNsYXRlIH19XG4gICAgICAgICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgICAgICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY2hhbmdlUGFzc3dvcmRcIj5cbiAgICAgICAgICAgICAgICB7eyAnQ2FuY2VsIHBhc3N3b3JkIGNoYW5nZScgfCB0cmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgICAgICA8ZGl2ICpuZ0lmPVwiY2hhbmdlUGFzc3dvcmRcIj5cbiAgICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5wYXNzd29yZFwiIHRyYW5zbGF0ZT5QYXNzd29yZDwvbGFiZWw+XG4gICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICAgICAgICAgICAgICAgIGlkPVwiY29uZmlnLnVzZXJQYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgbmFtZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy51c2VyUGFzc3dvcmRcIlxuICAgICAgICAgICAgICAgIGF1dG9jb21wbGV0ZT1cIm5ldy1wYXNzd29yZFwiXG4gICAgICAgICAgICAgICAgcmVxdWlyZWRcbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPCEtLSBjaGFuZ2UgcGFzc3dvcmQgc2VjdGlvbiBFTkRTLS0+XG4gICAgICA8L2Rpdj5cbiAgICAgIDwhLS0gS2V5LWJhc2VkIC0tPlxuICAgICAgPGRpdiAqbmdJZj1cImF1dGhlbnRpY2F0aW9uTW9kZS5pZCA9PT0gM1wiIGNsYXNzPVwidGlnaHQtZ3JpZFwiPlxuICAgICAgICA8IS0tIEtFWVNUT1JFIFBBU1NXT1JEIC0tPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTZcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgICAgPGxhYmVsIGZvcj1cImNvbmZpZy5rZXlzdG9yZVBhc3NcIiB0cmFuc2xhdGU+S2V5c3RvcmUgcGFzc3dvcmQ8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCJwYXNzd29yZFwiXG4gICAgICAgICAgICAgIGNsYXNzPVwiZm9ybS1jb250cm9sXCJcbiAgICAgICAgICAgICAgaWQ9XCJjb25maWcua2V5c3RvcmVQYXNzXCJcbiAgICAgICAgICAgICAgbmFtZT1cImtleXN0b3JlUGFzc1wiXG4gICAgICAgICAgICAgIFsobmdNb2RlbCldPVwibW9kZWwuY29uZmlnLmtleXN0b3JlUGFzc1wiXG4gICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImNvbC1tZC02XCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjb25maWcuY2VydGlmaWNhdGVQYXNzXCIgdHJhbnNsYXRlPkNlcnRpZmljYXRlIHBhc3N3b3JkPC9sYWJlbD5cbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICB0eXBlPVwicGFzc3dvcmRcIlxuICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgIGlkPVwiY29uZmlnLmNlcnRpZmljYXRlUGFzc1wiXG4gICAgICAgICAgICAgIG5hbWU9XCJrZXlzdG9yZVBhc3NcIlxuICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cIm1vZGVsLmNvbmZpZy5jZXJ0aWZpY2F0ZVBhc3NcIlxuICAgICAgICAgICAgICByZXF1aXJlZFxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDwhLS0gVVBMT0FEIEtFWVNUT1JFIC0tPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiY29sLW1kLTEyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICAgIDxsYWJlbCBmb3I9XCJjZXJ0aWZpY2F0ZVVwbG9hZFwiIHRyYW5zbGF0ZT5VcGxvYWQga2V5c3RvcmU8L2xhYmVsPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgW3JlYWRvbmx5XT1cInRydWVcIlxuICAgICAgICAgICAgICBuYW1lPVwiY2VydGlmaWNhdGVVcGxvYWRcIlxuICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbCBtLWItOFwiXG4gICAgICAgICAgICAgIFtuZ01vZGVsXT1cImZpbGVOYW1lXCJcbiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJ7eyAnZS5nLicgfCB0cmFuc2xhdGUgfX0geW91cktleXN0b3JlLmprc1wiXG4gICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAgPGM4eS1kcm9wLWFyZWFcbiAgICAgICAgICAgICAgKGRyb3BwZWQpPVwidXBsb2FkRmlsZSgkZXZlbnQpXCJcbiAgICAgICAgICAgICAgW2xvYWRpbmdNZXNzYWdlXT1cIidJbXBvcnRpbmcsIHBsZWFzZSB3YWl0LicgfCB0cmFuc2xhdGVcIlxuICAgICAgICAgICAgICBbdGl0bGVdPVwiJ0ltcG9ydCBrZXlzdG9yZSB3aXRoIGprcyBmaWxlIGV4dGVuc2lvbicgfCB0cmFuc2xhdGVcIlxuICAgICAgICAgICAgPjwvYzh5LWRyb3AtYXJlYT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgPC9kaXY+XG4gIDxkaXYgY2xhc3M9XCJjYXJkLWZvb3RlciBsYXJnZS1wYWRkaW5nIHNlcGFyYXRvciBzdGlja3ktYm90dG9tXCI+XG4gICAgPGJ1dHRvblxuICAgICAgdGl0bGU9XCJ7eyAnQ2FuY2VsJyB8IHRyYW5zbGF0ZSB9fVwiXG4gICAgICB0eXBlPVwiYnV0dG9uXCJcbiAgICAgIGNsYXNzPVwiYnRuIGJ0bi1kZWZhdWx0XCJcbiAgICAgIChjbGljayk9XCJjYW5jZWwoKVwiXG4gICAgPlxuICAgICAge3sgJ0NhbmNlbCcgfCB0cmFuc2xhdGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgICA8YnV0dG9uXG4gICAgICB0aXRsZT1cInt7ICdSZW1vdmUnIHwgdHJhbnNsYXRlIH19XCJcbiAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgY2xhc3M9XCJidG4gYnRuLWRhbmdlclwiXG4gICAgICAoY2xpY2spPVwicmVtb3ZlKClcIlxuICAgID5cbiAgICAgIHt7ICdSZW1vdmUnIHwgdHJhbnNsYXRlIH19XG4gICAgPC9idXR0b24+XG4gICAgPGJ1dHRvblxuICAgICAgdGl0bGU9XCJ7eyAnU2F2ZScgfCB0cmFuc2xhdGUgfX1cIlxuICAgICAgdHlwZT1cInN1Ym1pdFwiXG4gICAgICBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiXG4gICAgICAoY2xpY2spPVwic2F2ZSgpXCJcbiAgICAgIFtkaXNhYmxlZF09XCIhb3BjdWFDb25maWdGb3JtLnZhbGlkXCJcbiAgICA+XG4gICAgICB7eyAnU2F2ZScgfCB0cmFuc2xhdGUgfX1cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG48L2Zvcm0+XG4iXX0=