import { TranslateDirective, TranslateService } from '@ngx-translate/core';
import { ChangeDetectorRef, Directive, ElementRef, EventEmitter } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@ngx-translate/core";
export class C8yTranslateDirective extends TranslateDirective {
    constructor(translateService, element, _ref) {
        super(translateService, element, _ref);
        /**
         * Used to trigger events when html is replaced by directive.
         */
        this.htmlUpdateEvent = new EventEmitter();
    }
    /**
     * Used to get private element property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _elementRef() {
        return this.element;
    }
    /**
     * Used to get private translateService property from TranslateDirective, so it doesn't throw tsErrors
     */
    get _translateService() {
        return this.translateService;
    }
    /**
     * Overridden method from original directive.
     * For simple text nodes, it just invokes the base method.
     * For complex nodes, it builds translation key from whole inner HTML
     * and replaces it with its translation.
     * This prevents splitting HTML into pieces and attempting to translate each one separately
     * which doesn't work, because we extract strings in whole.
     */
    checkNodes(forceUpdate = false, translations) {
        if (!this.htmlMode && (this.isElementSimpleTextType() || this.isElementInnerHtmlEmpty())) {
            /**
             * If element does not contain complex html, then fallBack to default logic.
             */
            super.checkNodes(forceUpdate, translations);
        }
        else {
            this.htmlMode = true;
            if (this.isLookupKeyMissing()) {
                this._elementRef.nativeElement.lookupKey = this.getLookupKey();
            }
            if (this.lookupKeyExist()) {
                const newTranslation = this.getNewTranslation();
                if (!this.lastTranslation || this.lastTranslation !== newTranslation) {
                    this.lastTranslation = newTranslation;
                    this.updateHtmlContent();
                    this.htmlUpdateEvent.emit();
                }
            }
        }
    }
    ngOnDestroy() {
        this.htmlUpdateEvent.complete();
        super.ngOnDestroy();
    }
    /**
     * Builds lookup key from innerHTML, removes comments (that might be added by Angular) and trims it.
     */
    getLookupKey() {
        return this._elementRef.nativeElement.innerHTML.replace(/<!--.*?-->/gs, '').trim();
    }
    isElementSimpleTextType() {
        return (this._elementRef.nativeElement.childNodes.length === 1 &&
            this._elementRef.nativeElement.childNodes[0].nodeType === 3);
    }
    isElementInnerHtmlEmpty() {
        return !this._elementRef.nativeElement.innerHTML;
    }
    isLookupKeyMissing() {
        return !this._elementRef.nativeElement.lookupKey;
    }
    lookupKeyExist() {
        return this._elementRef.nativeElement.lookupKey;
    }
    getNewTranslation() {
        return this._translateService.instant(this._elementRef.nativeElement.lookupKey, this.currentParams || {});
    }
    updateHtmlContent() {
        this._elementRef.nativeElement.innerHTML = this.lastTranslation;
    }
}
C8yTranslateDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: C8yTranslateDirective, deps: [{ token: i1.TranslateService }, { token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Directive });
C8yTranslateDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.0.6", type: C8yTranslateDirective, selector: "[translate],[ngx-translate]", usesInheritance: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: C8yTranslateDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[translate],[ngx-translate]'
                }]
        }], ctorParameters: function () { return [{ type: i1.TranslateService }, { type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYzh5LXRyYW5zbGF0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL2kxOG4vYzh5LXRyYW5zbGF0ZS5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGtCQUFrQixFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDM0UsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sZUFBZSxDQUFDOzs7QUFLdkYsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGtCQUFrQjtJQWdDM0QsWUFBWSxnQkFBa0MsRUFBRSxPQUFtQixFQUFFLElBQXVCO1FBQzFGLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFsQnpDOztXQUVHO1FBQ0gsb0JBQWUsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQztJQWdCL0QsQ0FBQztJQWpDRDs7T0FFRztJQUNILElBQVksV0FBVztRQUNyQixPQUFRLElBQVksQ0FBQyxPQUFPLENBQUM7SUFDL0IsQ0FBQztJQUVEOztPQUVHO0lBQ0gsSUFBWSxpQkFBaUI7UUFDM0IsT0FBUSxJQUFZLENBQUMsZ0JBQWdCLENBQUM7SUFDeEMsQ0FBQztJQXVCRDs7Ozs7OztPQU9HO0lBQ0gsVUFBVSxDQUFDLFdBQVcsR0FBRyxLQUFLLEVBQUUsWUFBa0I7UUFDaEQsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsSUFBSSxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxFQUFFO1lBQ3hGOztlQUVHO1lBQ0gsS0FBSyxDQUFDLFVBQVUsQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDN0M7YUFBTTtZQUNMLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1lBQ3JCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7YUFDaEU7WUFDRCxJQUFJLElBQUksQ0FBQyxjQUFjLEVBQUUsRUFBRTtnQkFDekIsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ2hELElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxJQUFJLElBQUksQ0FBQyxlQUFlLEtBQUssY0FBYyxFQUFFO29CQUNwRSxJQUFJLENBQUMsZUFBZSxHQUFHLGNBQWMsQ0FBQztvQkFDdEMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7b0JBQ3pCLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7aUJBQzdCO2FBQ0Y7U0FDRjtJQUNILENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNoQyxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ssWUFBWTtRQUNsQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JGLENBQUM7SUFFTyx1QkFBdUI7UUFDN0IsT0FBTyxDQUNMLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQztZQUN0RCxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLENBQUMsQ0FDNUQsQ0FBQztJQUNKLENBQUM7SUFFTyx1QkFBdUI7UUFDN0IsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQztJQUNuRCxDQUFDO0lBRU8sa0JBQWtCO1FBQ3hCLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7SUFDbkQsQ0FBQztJQUVPLGNBQWM7UUFDcEIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxTQUFTLENBQUM7SUFDbEQsQ0FBQztJQUVPLGlCQUFpQjtRQUN2QixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQ25DLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFDeEMsSUFBSSxDQUFDLGFBQWEsSUFBSSxFQUFFLENBQ3pCLENBQUM7SUFDSixDQUFDO0lBRU8saUJBQWlCO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQ2xFLENBQUM7O2tIQTFHVSxxQkFBcUI7c0dBQXJCLHFCQUFxQjsyRkFBckIscUJBQXFCO2tCQUhqQyxTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSw2QkFBNkI7aUJBQ3hDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVHJhbnNsYXRlRGlyZWN0aXZlLCBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBDaGFuZ2VEZXRlY3RvclJlZiwgRGlyZWN0aXZlLCBFbGVtZW50UmVmLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW3RyYW5zbGF0ZV0sW25neC10cmFuc2xhdGVdJ1xufSlcbmV4cG9ydCBjbGFzcyBDOHlUcmFuc2xhdGVEaXJlY3RpdmUgZXh0ZW5kcyBUcmFuc2xhdGVEaXJlY3RpdmUge1xuICAvKipcbiAgICogVXNlZCB0byBnZXQgcHJpdmF0ZSBlbGVtZW50IHByb3BlcnR5IGZyb20gVHJhbnNsYXRlRGlyZWN0aXZlLCBzbyBpdCBkb2Vzbid0IHRocm93IHRzRXJyb3JzXG4gICAqL1xuICBwcml2YXRlIGdldCBfZWxlbWVudFJlZigpOiBFbGVtZW50UmVmIHtcbiAgICByZXR1cm4gKHRoaXMgYXMgYW55KS5lbGVtZW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gZ2V0IHByaXZhdGUgdHJhbnNsYXRlU2VydmljZSBwcm9wZXJ0eSBmcm9tIFRyYW5zbGF0ZURpcmVjdGl2ZSwgc28gaXQgZG9lc24ndCB0aHJvdyB0c0Vycm9yc1xuICAgKi9cbiAgcHJpdmF0ZSBnZXQgX3RyYW5zbGF0ZVNlcnZpY2UoKTogVHJhbnNsYXRlU2VydmljZSB7XG4gICAgcmV0dXJuICh0aGlzIGFzIGFueSkudHJhbnNsYXRlU2VydmljZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVc2VkIHRvIHRyaWdnZXIgZXZlbnRzIHdoZW4gaHRtbCBpcyByZXBsYWNlZCBieSBkaXJlY3RpdmUuXG4gICAqL1xuICBodG1sVXBkYXRlRXZlbnQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICAvKipcbiAgICogV2hlbiB0aGlzIGRpcmVjdGl2ZSBzdWNjZXNzZnVsbHkgdHJhbnNsYXRlcyBub2RlLCBpdCBzdG9yZXMgaXRzIHZhbHVlIGluIHRoaXMgcHJvcGVydHkuXG4gICAqIEFub3RoZXIgdHJhbnNsYXRpb24gd2lsbCBiZSBwZXJmb3JtZWQgb25seSBpZiBuZXcgdHJhbnNsYXRpb24gdmFsdWUgZGlmZmVycyBmcm9tIHN0b3JlZCBvbmUuXG4gICAqL1xuICBsYXN0VHJhbnNsYXRpb246IHN0cmluZztcblxuICAvKipcbiAgICogV2hlbiB0aGlzIGRpcmVjdGl2ZSBlbmNvdW50ZXJzIGVsZW1lbnQgdGhhdCBpcyBIVE1MLCBpdCBzaG91bGQgc3dpdGNoIHRvIEh0bWwgbW9kZSBldmVuIGlmXG4gICAqIG5ldyB0cmFuc2xhdGVkIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBhbnkgSFRNTC5cbiAgICovXG4gIGh0bWxNb2RlOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKHRyYW5zbGF0ZVNlcnZpY2U6IFRyYW5zbGF0ZVNlcnZpY2UsIGVsZW1lbnQ6IEVsZW1lbnRSZWYsIF9yZWY6IENoYW5nZURldGVjdG9yUmVmKSB7XG4gICAgc3VwZXIodHJhbnNsYXRlU2VydmljZSwgZWxlbWVudCwgX3JlZik7XG4gIH1cblxuICAvKipcbiAgICogT3ZlcnJpZGRlbiBtZXRob2QgZnJvbSBvcmlnaW5hbCBkaXJlY3RpdmUuXG4gICAqIEZvciBzaW1wbGUgdGV4dCBub2RlcywgaXQganVzdCBpbnZva2VzIHRoZSBiYXNlIG1ldGhvZC5cbiAgICogRm9yIGNvbXBsZXggbm9kZXMsIGl0IGJ1aWxkcyB0cmFuc2xhdGlvbiBrZXkgZnJvbSB3aG9sZSBpbm5lciBIVE1MXG4gICAqIGFuZCByZXBsYWNlcyBpdCB3aXRoIGl0cyB0cmFuc2xhdGlvbi5cbiAgICogVGhpcyBwcmV2ZW50cyBzcGxpdHRpbmcgSFRNTCBpbnRvIHBpZWNlcyBhbmQgYXR0ZW1wdGluZyB0byB0cmFuc2xhdGUgZWFjaCBvbmUgc2VwYXJhdGVseVxuICAgKiB3aGljaCBkb2Vzbid0IHdvcmssIGJlY2F1c2Ugd2UgZXh0cmFjdCBzdHJpbmdzIGluIHdob2xlLlxuICAgKi9cbiAgY2hlY2tOb2Rlcyhmb3JjZVVwZGF0ZSA9IGZhbHNlLCB0cmFuc2xhdGlvbnM/OiBhbnkpIHtcbiAgICBpZiAoIXRoaXMuaHRtbE1vZGUgJiYgKHRoaXMuaXNFbGVtZW50U2ltcGxlVGV4dFR5cGUoKSB8fCB0aGlzLmlzRWxlbWVudElubmVySHRtbEVtcHR5KCkpKSB7XG4gICAgICAvKipcbiAgICAgICAqIElmIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBjb21wbGV4IGh0bWwsIHRoZW4gZmFsbEJhY2sgdG8gZGVmYXVsdCBsb2dpYy5cbiAgICAgICAqL1xuICAgICAgc3VwZXIuY2hlY2tOb2Rlcyhmb3JjZVVwZGF0ZSwgdHJhbnNsYXRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5odG1sTW9kZSA9IHRydWU7XG4gICAgICBpZiAodGhpcy5pc0xvb2t1cEtleU1pc3NpbmcoKSkge1xuICAgICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQubG9va3VwS2V5ID0gdGhpcy5nZXRMb29rdXBLZXkoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLmxvb2t1cEtleUV4aXN0KCkpIHtcbiAgICAgICAgY29uc3QgbmV3VHJhbnNsYXRpb24gPSB0aGlzLmdldE5ld1RyYW5zbGF0aW9uKCk7XG4gICAgICAgIGlmICghdGhpcy5sYXN0VHJhbnNsYXRpb24gfHwgdGhpcy5sYXN0VHJhbnNsYXRpb24gIT09IG5ld1RyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgdGhpcy5sYXN0VHJhbnNsYXRpb24gPSBuZXdUcmFuc2xhdGlvbjtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUh0bWxDb250ZW50KCk7XG4gICAgICAgICAgdGhpcy5odG1sVXBkYXRlRXZlbnQuZW1pdCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5odG1sVXBkYXRlRXZlbnQuY29tcGxldGUoKTtcbiAgICBzdXBlci5uZ09uRGVzdHJveSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEJ1aWxkcyBsb29rdXAga2V5IGZyb20gaW5uZXJIVE1MLCByZW1vdmVzIGNvbW1lbnRzICh0aGF0IG1pZ2h0IGJlIGFkZGVkIGJ5IEFuZ3VsYXIpIGFuZCB0cmltcyBpdC5cbiAgICovXG4gIHByaXZhdGUgZ2V0TG9va3VwS2V5KCkge1xuICAgIHJldHVybiB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MLnJlcGxhY2UoLzwhLS0uKj8tLT4vZ3MsICcnKS50cmltKCk7XG4gIH1cblxuICBwcml2YXRlIGlzRWxlbWVudFNpbXBsZVRleHRUeXBlKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAoXG4gICAgICB0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEgJiZcbiAgICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzWzBdLm5vZGVUeXBlID09PSAzXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNFbGVtZW50SW5uZXJIdG1sRW1wdHkoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuaW5uZXJIVE1MO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0xvb2t1cEtleU1pc3NpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQubG9va3VwS2V5O1xuICB9XG5cbiAgcHJpdmF0ZSBsb29rdXBLZXlFeGlzdCgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxvb2t1cEtleTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TmV3VHJhbnNsYXRpb24oKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fdHJhbnNsYXRlU2VydmljZS5pbnN0YW50KFxuICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50Lmxvb2t1cEtleSxcbiAgICAgIHRoaXMuY3VycmVudFBhcmFtcyB8fCB7fVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUh0bWxDb250ZW50KCk6IHZvaWQge1xuICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLmxhc3RUcmFuc2xhdGlvbjtcbiAgfVxufVxuIl19