import { Component, ViewChild } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { C8yStepper, gettext, OptionsService, WizardComponent } from '@c8y/ngx-components';
import { uniqBy } from 'lodash-es';
import { TranslateService } from '@ngx-translate/core';
import * as i0 from "@angular/core";
import * as i1 from "@c8y/ngx-components";
import * as i2 from "@angular/forms";
import * as i3 from "@ngx-translate/core";
import * as i4 from "@angular/common";
import * as i5 from "@angular/cdk/stepper";
import * as i6 from "./license-view.component";
export class LicenseConfirmModalComponent {
    constructor(wizardComponent, fb, optionsService, translateService) {
        this.wizardComponent = wizardComponent;
        this.fb = fb;
        this.optionsService = optionsService;
        this.translateService = translateService;
        this.licenses = [];
    }
    ngOnInit() {
        const { pluginsToInstall } = this.wizardComponent.componentInitialState;
        this.formGroupAccept = this.fb.group({
            confirmed: [false, Validators.required]
        });
        this.formGroupLicenses = this.fb.group({
            acceptAll: [false, Validators.required]
        });
        const allLicenses = pluginsToInstall.map(app => ({
            appName: app.name,
            url: `/apps/${app.contextPath}@${app.version}/LICENSE.txt`,
            licenseName: app.license
        }));
        const uniqByUrl = uniqBy(allLicenses, 'url').map(license => ({
            ...license,
            pluginName: allLicenses
                .filter(({ url }) => url === license.url)
                .map(({ appName: pluginName }) => pluginName)
                .join(', ')
        }));
        const companyName = this.optionsService.get('companyName', 'Cumulocity');
        const textWithCompany = gettext('They do not constitute part of the {{companyName}} product suite. Users are free to use subject to the license agreement.');
        const textWithoutCompany = gettext('They do not constitute part of the product suite. Users are free to use subject to the license agreement.');
        this.disclaimerText = this.translateService.instant(companyName ? textWithCompany : textWithoutCompany, {
            companyName
        });
        this.licenses = uniqByUrl;
    }
    cancel() {
        this.wizardComponent.close(false);
    }
    done() {
        this.wizardComponent.close(true);
    }
}
LicenseConfirmModalComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: LicenseConfirmModalComponent, deps: [{ token: i1.WizardComponent }, { token: i2.FormBuilder }, { token: i1.OptionsService }, { token: i3.TranslateService }], target: i0.ɵɵFactoryTarget.Component });
LicenseConfirmModalComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.0.6", type: LicenseConfirmModalComponent, selector: "c8y-license-confirm-modal", viewQueries: [{ propertyName: "stepper", first: true, predicate: C8yStepper, descendants: true, static: true }], ngImport: i0, template: "<c8y-wizard-header>\n  <i c8yIcon=\"privacy-policy\"></i>\n  <div id=\"modal-title\" class=\"modal-title h4\" translate>Accept license(s)</div>\n</c8y-wizard-header>\n<c8y-wizard-body>\n  <div class=\"m-t-16 m-l-32 m-r-32\">\n    <c8y-stepper>\n      <cdk-step [stepControl]=\"formGroupAccept\" [label]=\"'Disclaimer' | translate\">\n        <div class=\"m-t-8\">\n          <div class=\"text-center m-b-16 h4\">\n            <i c8yIcon=\"info-circle\" class=\"text-info d-block icon-40 m-b-8\"></i>\n            {{ 'About community packages' | translate }}\n          </div>\n          <p class=\"m-b-16\">\n            <span translate>These plugins and/or blueprints are provided\n            <strong>as-is and without warranty or support</strong>.</span>\n            {{disclaimerText}}\n          </p>\n          <hr style=\"margin: 16px -24px 16px\" />\n          <div class=\"text-center\">\n            <c8y-form-group class=\"d-inline-block\">\n              <div [formGroup]=\"formGroupAccept\" class=\"d-flex d-col a-i-center\">\n                <label class=\"c8y-checkbox\">\n                  <input\n                    type=\"checkbox\"\n                    class=\"form-control\"\n                    formControlName=\"confirmed\"\n                    required\n                  />\n                  <span></span>\n                  <span translate>Understood and agreed</span>\n                </label>\n                <c8y-messages class=\"d-inline-block\">\n                  <c8y-message\n                    [name]=\"'required'\"\n                    [text]=\"'Accept the maintenance disclaimer.' | translate\"\n                  ></c8y-message>\n                </c8y-messages>\n              </div>\n            </c8y-form-group>\n          </div>\n        </div>\n\n        <c8y-wizard-footer *ngIf=\"stepper.selectedIndex === 0\">\n          <c8y-stepper-buttons\n            [title]=\"'Confirm agreement' | translate\"\n            [showButtons]=\"{ next: true, cancel: true, back: false, custom: false }\"\n            (onCancel)=\"cancel()\"\n          ></c8y-stepper-buttons>\n        </c8y-wizard-footer>\n      </cdk-step>\n      <cdk-step state=\"final\" [stepControl]=\"formGroupLicenses\" [label]=\"'Licenses' | translate\">\n        <div *ngFor=\"let license of licenses\" class=\"p-t-24\">\n          <label\n            *ngIf=\"license.licenseName\"\n            translate\n            [translateParams]=\"{ appName: license.appName, licenseName: license.licenseName }\"\n            ngNonBindable\n            class=\"text-normal\"\n          >\n            <b>{{ appName }}</b>\n            using\n            <b>{{ licenseName }}</b>\n            license\n          </label>\n          <label\n            *ngIf=\"!license.licenseName\"\n            translate\n            [translateParams]=\"{ appName: license.appName, licenseName: license.licenseName }\"\n            ngNonBindable\n            class=\"text-normal\"\n          >\n            <b>{{ appName }}</b>\n            using\n            <b>no license</b>\n          </label>\n          <c8y-license-view [url]=\"license.url\" [name]=\"license.licenseName\"></c8y-license-view>\n        </div>\n        <c8y-wizard-footer *ngIf=\"stepper.selectedIndex === 1\">\n          <c8y-form-group class=\"text-center d-inline-block\">\n            <div [formGroup]=\"formGroupLicenses\" class=\"d-flex d-col a-i-center\">\n              <label class=\"c8y-checkbox\">\n                <input type=\"checkbox\" class=\"form-control\" formControlName=\"acceptAll\" required />\n                <span></span>\n                <span *ngIf=\"licenses.length === 1\" translate>Accept license</span>\n                <span *ngIf=\"licenses.length > 1\" translate>Accept all licenses</span>\n              </label>\n              <c8y-messages class=\"d-inline-block\">\n                <c8y-message\n                  [name]=\"'required'\"\n                  [text]=\"'You need to accept the license agreement(s)' | translate\"\n                ></c8y-message>\n              </c8y-messages>\n            </div>\n          </c8y-form-group>\n          <hr style=\"margin: 0 -24px 16px\" />\n          <c8y-stepper-buttons\n            [title]=\"'Accept license' | translate\"\n            [showButtons]=\"{ next: true, cancel: true, back: false, custom: false }\"\n            (onCancel)=\"cancel()\"\n            (onNext)=\"done()\"\n          ></c8y-stepper-buttons>\n        </c8y-wizard-footer>\n      </cdk-step>\n    </c8y-stepper>\n  </div>\n</c8y-wizard-body>\n", dependencies: [{ kind: "directive", type: i1.IconDirective, selector: "[c8yIcon]", inputs: ["c8yIcon"] }, { kind: "directive", type: i1.C8yTranslateDirective, selector: "[translate],[ngx-translate]" }, { kind: "directive", type: i4.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i2.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i2.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i2.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i2.CheckboxRequiredValidator, selector: "input[type=checkbox][required][formControlName],input[type=checkbox][required][formControl],input[type=checkbox][required][ngModel]" }, { kind: "component", type: i1.FormGroupComponent, selector: "c8y-form-group", inputs: ["hasError", "hasWarning", "hasSuccess", "novalidation", "status"] }, { kind: "directive", type: i1.MessageDirective, selector: "c8y-message", inputs: ["name", "text"] }, { kind: "component", type: i1.MessagesComponent, selector: "c8y-messages", inputs: ["show", "defaults"] }, { kind: "directive", type: i1.RequiredInputPlaceholderDirective, selector: "input[required], input[formControlName]" }, { kind: "component", type: i1.C8yStepper, selector: "c8y-stepper", inputs: ["disableDefaultIcons", "disableProgressButtons", "customClasses", "hideStepProgress", "useStepLabelsAsTitlesOnly"], outputs: ["onStepChange"] }, { kind: "component", type: i5.CdkStep, selector: "cdk-step", inputs: ["stepControl", "label", "errorMessage", "aria-label", "aria-labelledby", "state", "editable", "optional", "completed", "hasError"], outputs: ["interacted"], exportAs: ["cdkStep"] }, { kind: "component", type: i1.C8yStepperButtons, selector: "c8y-stepper-buttons", inputs: ["labels", "pending", "disabled", "showButtons"], outputs: ["onCancel", "onNext", "onBack", "onCustom"] }, { kind: "component", type: i1.WizardHeaderComponent, selector: "c8y-wizard-header" }, { kind: "component", type: i1.WizardBodyComponent, selector: "c8y-wizard-body" }, { kind: "component", type: i1.WizardFooterComponent, selector: "c8y-wizard-footer" }, { kind: "directive", type: i2.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i2.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "component", type: i6.LicenseViewComponent, selector: "c8y-license-view", inputs: ["url", "name"] }, { kind: "pipe", type: i1.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: LicenseConfirmModalComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-license-confirm-modal', template: "<c8y-wizard-header>\n  <i c8yIcon=\"privacy-policy\"></i>\n  <div id=\"modal-title\" class=\"modal-title h4\" translate>Accept license(s)</div>\n</c8y-wizard-header>\n<c8y-wizard-body>\n  <div class=\"m-t-16 m-l-32 m-r-32\">\n    <c8y-stepper>\n      <cdk-step [stepControl]=\"formGroupAccept\" [label]=\"'Disclaimer' | translate\">\n        <div class=\"m-t-8\">\n          <div class=\"text-center m-b-16 h4\">\n            <i c8yIcon=\"info-circle\" class=\"text-info d-block icon-40 m-b-8\"></i>\n            {{ 'About community packages' | translate }}\n          </div>\n          <p class=\"m-b-16\">\n            <span translate>These plugins and/or blueprints are provided\n            <strong>as-is and without warranty or support</strong>.</span>\n            {{disclaimerText}}\n          </p>\n          <hr style=\"margin: 16px -24px 16px\" />\n          <div class=\"text-center\">\n            <c8y-form-group class=\"d-inline-block\">\n              <div [formGroup]=\"formGroupAccept\" class=\"d-flex d-col a-i-center\">\n                <label class=\"c8y-checkbox\">\n                  <input\n                    type=\"checkbox\"\n                    class=\"form-control\"\n                    formControlName=\"confirmed\"\n                    required\n                  />\n                  <span></span>\n                  <span translate>Understood and agreed</span>\n                </label>\n                <c8y-messages class=\"d-inline-block\">\n                  <c8y-message\n                    [name]=\"'required'\"\n                    [text]=\"'Accept the maintenance disclaimer.' | translate\"\n                  ></c8y-message>\n                </c8y-messages>\n              </div>\n            </c8y-form-group>\n          </div>\n        </div>\n\n        <c8y-wizard-footer *ngIf=\"stepper.selectedIndex === 0\">\n          <c8y-stepper-buttons\n            [title]=\"'Confirm agreement' | translate\"\n            [showButtons]=\"{ next: true, cancel: true, back: false, custom: false }\"\n            (onCancel)=\"cancel()\"\n          ></c8y-stepper-buttons>\n        </c8y-wizard-footer>\n      </cdk-step>\n      <cdk-step state=\"final\" [stepControl]=\"formGroupLicenses\" [label]=\"'Licenses' | translate\">\n        <div *ngFor=\"let license of licenses\" class=\"p-t-24\">\n          <label\n            *ngIf=\"license.licenseName\"\n            translate\n            [translateParams]=\"{ appName: license.appName, licenseName: license.licenseName }\"\n            ngNonBindable\n            class=\"text-normal\"\n          >\n            <b>{{ appName }}</b>\n            using\n            <b>{{ licenseName }}</b>\n            license\n          </label>\n          <label\n            *ngIf=\"!license.licenseName\"\n            translate\n            [translateParams]=\"{ appName: license.appName, licenseName: license.licenseName }\"\n            ngNonBindable\n            class=\"text-normal\"\n          >\n            <b>{{ appName }}</b>\n            using\n            <b>no license</b>\n          </label>\n          <c8y-license-view [url]=\"license.url\" [name]=\"license.licenseName\"></c8y-license-view>\n        </div>\n        <c8y-wizard-footer *ngIf=\"stepper.selectedIndex === 1\">\n          <c8y-form-group class=\"text-center d-inline-block\">\n            <div [formGroup]=\"formGroupLicenses\" class=\"d-flex d-col a-i-center\">\n              <label class=\"c8y-checkbox\">\n                <input type=\"checkbox\" class=\"form-control\" formControlName=\"acceptAll\" required />\n                <span></span>\n                <span *ngIf=\"licenses.length === 1\" translate>Accept license</span>\n                <span *ngIf=\"licenses.length > 1\" translate>Accept all licenses</span>\n              </label>\n              <c8y-messages class=\"d-inline-block\">\n                <c8y-message\n                  [name]=\"'required'\"\n                  [text]=\"'You need to accept the license agreement(s)' | translate\"\n                ></c8y-message>\n              </c8y-messages>\n            </div>\n          </c8y-form-group>\n          <hr style=\"margin: 0 -24px 16px\" />\n          <c8y-stepper-buttons\n            [title]=\"'Accept license' | translate\"\n            [showButtons]=\"{ next: true, cancel: true, back: false, custom: false }\"\n            (onCancel)=\"cancel()\"\n            (onNext)=\"done()\"\n          ></c8y-stepper-buttons>\n        </c8y-wizard-footer>\n      </cdk-step>\n    </c8y-stepper>\n  </div>\n</c8y-wizard-body>\n" }]
        }], ctorParameters: function () { return [{ type: i1.WizardComponent }, { type: i2.FormBuilder }, { type: i1.OptionsService }, { type: i3.TranslateService }]; }, propDecorators: { stepper: [{
                type: ViewChild,
                args: [C8yStepper, { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGljZW5zZS1jb25maXJtLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2Vjb3N5c3RlbS9saWNlbnNlLWNvbmZpcm0vbGljZW5zZS1jb25maXJtLW1vZGFsLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL2Vjb3N5c3RlbS9saWNlbnNlLWNvbmZpcm0vbGljZW5zZS1jb25maXJtLW1vZGFsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdELE9BQU8sRUFBRSxXQUFXLEVBQWEsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEUsT0FBTyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzNGLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxXQUFXLENBQUM7QUFFbkMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7Ozs7O0FBZ0J2RCxNQUFNLE9BQU8sNEJBQTRCO0lBUXZDLFlBQ1UsZUFBcUQsRUFDckQsRUFBZSxFQUNmLGNBQThCLEVBQzlCLGdCQUFrQztRQUhsQyxvQkFBZSxHQUFmLGVBQWUsQ0FBc0M7UUFDckQsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQUNmLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO1FBUDVDLGFBQVEsR0FBYyxFQUFFLENBQUM7SUFRdEIsQ0FBQztJQUVKLFFBQVE7UUFDTixNQUFNLEVBQUUsZ0JBQWdCLEVBQUUsR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLHFCQUFxQixDQUFDO1FBRXhFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDbkMsU0FBUyxFQUFFLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUM7U0FDeEMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3JDLFNBQVMsRUFBRSxDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDO1NBQ3hDLENBQUMsQ0FBQztRQUVILE1BQU0sV0FBVyxHQUFjLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDMUQsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJO1lBQ2pCLEdBQUcsRUFBRSxTQUFTLEdBQUcsQ0FBQyxXQUFXLElBQUksR0FBRyxDQUFDLE9BQU8sY0FBYztZQUMxRCxXQUFXLEVBQUUsR0FBRyxDQUFDLE9BQU87U0FDekIsQ0FBQyxDQUFDLENBQUM7UUFFSixNQUFNLFNBQVMsR0FBSSxNQUFNLENBQUMsV0FBVyxFQUFFLEtBQUssQ0FBZSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDMUUsR0FBRyxPQUFPO1lBQ1YsVUFBVSxFQUFFLFdBQVc7aUJBQ3BCLE1BQU0sQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxPQUFPLENBQUMsR0FBRyxDQUFDO2lCQUN4QyxHQUFHLENBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDO2lCQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQ2QsQ0FBQyxDQUFDLENBQUM7UUFFSixNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7UUFDekUsTUFBTSxlQUFlLEdBQUcsT0FBTyxDQUM3QiwySEFBMkgsQ0FDNUgsQ0FBQztRQUNGLE1BQU0sa0JBQWtCLEdBQUcsT0FBTyxDQUNoQywyR0FBMkcsQ0FDNUcsQ0FBQztRQUVGLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FDakQsV0FBVyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGtCQUFrQixFQUNsRDtZQUNFLFdBQVc7U0FDWixDQUNGLENBQUM7UUFFRixJQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsQ0FBQztJQUM1QixDQUFDO0lBRUQsTUFBTTtRQUNKLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ3BDLENBQUM7SUFFRCxJQUFJO1FBQ0YsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQzs7eUhBaEVVLDRCQUE0Qjs2R0FBNUIsNEJBQTRCLDBHQUc1QixVQUFVLDhEQ3hCdkIsKzhJQTJHQTsyRkR0RmEsNEJBQTRCO2tCQUp4QyxTQUFTOytCQUNFLDJCQUEyQjs0TEFPckMsT0FBTztzQkFETixTQUFTO3VCQUFDLFVBQVUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQnVpbGRlciwgRm9ybUdyb3VwLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQzh5U3RlcHBlciwgZ2V0dGV4dCwgT3B0aW9uc1NlcnZpY2UsIFdpemFyZENvbXBvbmVudCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgdW5pcUJ5IH0gZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7IExpY2Vuc2VkQXBwbGljYXRpb25QbHVnaW4gfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL2Vjb3N5c3RlbS9zaGFyZWQnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuXG5pbnRlcmZhY2UgQ29uZmlybUluc3RhbGxNb2RhbCB7XG4gIHBsdWdpbnNUb0luc3RhbGw6IExpY2Vuc2VkQXBwbGljYXRpb25QbHVnaW5bXTtcbn1cblxuaW50ZXJmYWNlIExpY2Vuc2Uge1xuICBsaWNlbnNlTmFtZTogc3RyaW5nO1xuICB1cmw6IHN0cmluZztcbiAgYXBwTmFtZTogc3RyaW5nO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktbGljZW5zZS1jb25maXJtLW1vZGFsJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2xpY2Vuc2UtY29uZmlybS1tb2RhbC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgTGljZW5zZUNvbmZpcm1Nb2RhbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIGZvcm1Hcm91cEFjY2VwdDogRm9ybUdyb3VwO1xuICBmb3JtR3JvdXBMaWNlbnNlczogRm9ybUdyb3VwO1xuICBAVmlld0NoaWxkKEM4eVN0ZXBwZXIsIHsgc3RhdGljOiB0cnVlIH0pXG4gIHN0ZXBwZXI6IEM4eVN0ZXBwZXI7XG4gIGxpY2Vuc2VzOiBMaWNlbnNlW10gPSBbXTtcbiAgZGlzY2xhaW1lclRleHQ6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHdpemFyZENvbXBvbmVudDogV2l6YXJkQ29tcG9uZW50PENvbmZpcm1JbnN0YWxsTW9kYWw+LFxuICAgIHByaXZhdGUgZmI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgb3B0aW9uc1NlcnZpY2U6IE9wdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlU2VydmljZTogVHJhbnNsYXRlU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgeyBwbHVnaW5zVG9JbnN0YWxsIH0gPSB0aGlzLndpemFyZENvbXBvbmVudC5jb21wb25lbnRJbml0aWFsU3RhdGU7XG5cbiAgICB0aGlzLmZvcm1Hcm91cEFjY2VwdCA9IHRoaXMuZmIuZ3JvdXAoe1xuICAgICAgY29uZmlybWVkOiBbZmFsc2UsIFZhbGlkYXRvcnMucmVxdWlyZWRdXG4gICAgfSk7XG5cbiAgICB0aGlzLmZvcm1Hcm91cExpY2Vuc2VzID0gdGhpcy5mYi5ncm91cCh7XG4gICAgICBhY2NlcHRBbGw6IFtmYWxzZSwgVmFsaWRhdG9ycy5yZXF1aXJlZF1cbiAgICB9KTtcblxuICAgIGNvbnN0IGFsbExpY2Vuc2VzOiBMaWNlbnNlW10gPSBwbHVnaW5zVG9JbnN0YWxsLm1hcChhcHAgPT4gKHtcbiAgICAgIGFwcE5hbWU6IGFwcC5uYW1lLFxuICAgICAgdXJsOiBgL2FwcHMvJHthcHAuY29udGV4dFBhdGh9QCR7YXBwLnZlcnNpb259L0xJQ0VOU0UudHh0YCxcbiAgICAgIGxpY2Vuc2VOYW1lOiBhcHAubGljZW5zZVxuICAgIH0pKTtcblxuICAgIGNvbnN0IHVuaXFCeVVybCA9ICh1bmlxQnkoYWxsTGljZW5zZXMsICd1cmwnKSBhcyBMaWNlbnNlW10pLm1hcChsaWNlbnNlID0+ICh7XG4gICAgICAuLi5saWNlbnNlLFxuICAgICAgcGx1Z2luTmFtZTogYWxsTGljZW5zZXNcbiAgICAgICAgLmZpbHRlcigoeyB1cmwgfSkgPT4gdXJsID09PSBsaWNlbnNlLnVybClcbiAgICAgICAgLm1hcCgoeyBhcHBOYW1lOiBwbHVnaW5OYW1lIH0pID0+IHBsdWdpbk5hbWUpXG4gICAgICAgIC5qb2luKCcsICcpXG4gICAgfSkpO1xuXG4gICAgY29uc3QgY29tcGFueU5hbWUgPSB0aGlzLm9wdGlvbnNTZXJ2aWNlLmdldCgnY29tcGFueU5hbWUnLCAnQ3VtdWxvY2l0eScpO1xuICAgIGNvbnN0IHRleHRXaXRoQ29tcGFueSA9IGdldHRleHQoXG4gICAgICAnVGhleSBkbyBub3QgY29uc3RpdHV0ZSBwYXJ0IG9mIHRoZSB7e2NvbXBhbnlOYW1lfX0gcHJvZHVjdCBzdWl0ZS4gVXNlcnMgYXJlIGZyZWUgdG8gdXNlIHN1YmplY3QgdG8gdGhlIGxpY2Vuc2UgYWdyZWVtZW50LidcbiAgICApO1xuICAgIGNvbnN0IHRleHRXaXRob3V0Q29tcGFueSA9IGdldHRleHQoXG4gICAgICAnVGhleSBkbyBub3QgY29uc3RpdHV0ZSBwYXJ0IG9mIHRoZSBwcm9kdWN0IHN1aXRlLiBVc2VycyBhcmUgZnJlZSB0byB1c2Ugc3ViamVjdCB0byB0aGUgbGljZW5zZSBhZ3JlZW1lbnQuJ1xuICAgICk7XG5cbiAgICB0aGlzLmRpc2NsYWltZXJUZXh0ID0gdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmluc3RhbnQoXG4gICAgICBjb21wYW55TmFtZSA/IHRleHRXaXRoQ29tcGFueSA6IHRleHRXaXRob3V0Q29tcGFueSxcbiAgICAgIHtcbiAgICAgICAgY29tcGFueU5hbWVcbiAgICAgIH1cbiAgICApO1xuXG4gICAgdGhpcy5saWNlbnNlcyA9IHVuaXFCeVVybDtcbiAgfVxuXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLndpemFyZENvbXBvbmVudC5jbG9zZShmYWxzZSk7XG4gIH1cblxuICBkb25lKCkge1xuICAgIHRoaXMud2l6YXJkQ29tcG9uZW50LmNsb3NlKHRydWUpO1xuICB9XG59XG4iLCI8Yzh5LXdpemFyZC1oZWFkZXI+XG4gIDxpIGM4eUljb249XCJwcml2YWN5LXBvbGljeVwiPjwvaT5cbiAgPGRpdiBpZD1cIm1vZGFsLXRpdGxlXCIgY2xhc3M9XCJtb2RhbC10aXRsZSBoNFwiIHRyYW5zbGF0ZT5BY2NlcHQgbGljZW5zZShzKTwvZGl2PlxuPC9jOHktd2l6YXJkLWhlYWRlcj5cbjxjOHktd2l6YXJkLWJvZHk+XG4gIDxkaXYgY2xhc3M9XCJtLXQtMTYgbS1sLTMyIG0tci0zMlwiPlxuICAgIDxjOHktc3RlcHBlcj5cbiAgICAgIDxjZGstc3RlcCBbc3RlcENvbnRyb2xdPVwiZm9ybUdyb3VwQWNjZXB0XCIgW2xhYmVsXT1cIidEaXNjbGFpbWVyJyB8IHRyYW5zbGF0ZVwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwibS10LThcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwidGV4dC1jZW50ZXIgbS1iLTE2IGg0XCI+XG4gICAgICAgICAgICA8aSBjOHlJY29uPVwiaW5mby1jaXJjbGVcIiBjbGFzcz1cInRleHQtaW5mbyBkLWJsb2NrIGljb24tNDAgbS1iLThcIj48L2k+XG4gICAgICAgICAgICB7eyAnQWJvdXQgY29tbXVuaXR5IHBhY2thZ2VzJyB8IHRyYW5zbGF0ZSB9fVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxwIGNsYXNzPVwibS1iLTE2XCI+XG4gICAgICAgICAgICA8c3BhbiB0cmFuc2xhdGU+VGhlc2UgcGx1Z2lucyBhbmQvb3IgYmx1ZXByaW50cyBhcmUgcHJvdmlkZWRcbiAgICAgICAgICAgIDxzdHJvbmc+YXMtaXMgYW5kIHdpdGhvdXQgd2FycmFudHkgb3Igc3VwcG9ydDwvc3Ryb25nPi48L3NwYW4+XG4gICAgICAgICAgICB7e2Rpc2NsYWltZXJUZXh0fX1cbiAgICAgICAgICA8L3A+XG4gICAgICAgICAgPGhyIHN0eWxlPVwibWFyZ2luOiAxNnB4IC0yNHB4IDE2cHhcIiAvPlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgICAgPGM4eS1mb3JtLWdyb3VwIGNsYXNzPVwiZC1pbmxpbmUtYmxvY2tcIj5cbiAgICAgICAgICAgICAgPGRpdiBbZm9ybUdyb3VwXT1cImZvcm1Hcm91cEFjY2VwdFwiIGNsYXNzPVwiZC1mbGV4IGQtY29sIGEtaS1jZW50ZXJcIj5cbiAgICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJjOHktY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgICAgICAgICBjbGFzcz1cImZvcm0tY29udHJvbFwiXG4gICAgICAgICAgICAgICAgICAgIGZvcm1Db250cm9sTmFtZT1cImNvbmZpcm1lZFwiXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkXG4gICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgPHNwYW4+PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPHNwYW4gdHJhbnNsYXRlPlVuZGVyc3Rvb2QgYW5kIGFncmVlZDwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgICAgICAgIDxjOHktbWVzc2FnZXMgY2xhc3M9XCJkLWlubGluZS1ibG9ja1wiPlxuICAgICAgICAgICAgICAgICAgPGM4eS1tZXNzYWdlXG4gICAgICAgICAgICAgICAgICAgIFtuYW1lXT1cIidyZXF1aXJlZCdcIlxuICAgICAgICAgICAgICAgICAgICBbdGV4dF09XCInQWNjZXB0IHRoZSBtYWludGVuYW5jZSBkaXNjbGFpbWVyLicgfCB0cmFuc2xhdGVcIlxuICAgICAgICAgICAgICAgICAgPjwvYzh5LW1lc3NhZ2U+XG4gICAgICAgICAgICAgICAgPC9jOHktbWVzc2FnZXM+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9jOHktZm9ybS1ncm91cD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgPGM4eS13aXphcmQtZm9vdGVyICpuZ0lmPVwic3RlcHBlci5zZWxlY3RlZEluZGV4ID09PSAwXCI+XG4gICAgICAgICAgPGM4eS1zdGVwcGVyLWJ1dHRvbnNcbiAgICAgICAgICAgIFt0aXRsZV09XCInQ29uZmlybSBhZ3JlZW1lbnQnIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgICAgIFtzaG93QnV0dG9uc109XCJ7IG5leHQ6IHRydWUsIGNhbmNlbDogdHJ1ZSwgYmFjazogZmFsc2UsIGN1c3RvbTogZmFsc2UgfVwiXG4gICAgICAgICAgICAob25DYW5jZWwpPVwiY2FuY2VsKClcIlxuICAgICAgICAgID48L2M4eS1zdGVwcGVyLWJ1dHRvbnM+XG4gICAgICAgIDwvYzh5LXdpemFyZC1mb290ZXI+XG4gICAgICA8L2Nkay1zdGVwPlxuICAgICAgPGNkay1zdGVwIHN0YXRlPVwiZmluYWxcIiBbc3RlcENvbnRyb2xdPVwiZm9ybUdyb3VwTGljZW5zZXNcIiBbbGFiZWxdPVwiJ0xpY2Vuc2VzJyB8IHRyYW5zbGF0ZVwiPlxuICAgICAgICA8ZGl2ICpuZ0Zvcj1cImxldCBsaWNlbnNlIG9mIGxpY2Vuc2VzXCIgY2xhc3M9XCJwLXQtMjRcIj5cbiAgICAgICAgICA8bGFiZWxcbiAgICAgICAgICAgICpuZ0lmPVwibGljZW5zZS5saWNlbnNlTmFtZVwiXG4gICAgICAgICAgICB0cmFuc2xhdGVcbiAgICAgICAgICAgIFt0cmFuc2xhdGVQYXJhbXNdPVwieyBhcHBOYW1lOiBsaWNlbnNlLmFwcE5hbWUsIGxpY2Vuc2VOYW1lOiBsaWNlbnNlLmxpY2Vuc2VOYW1lIH1cIlxuICAgICAgICAgICAgbmdOb25CaW5kYWJsZVxuICAgICAgICAgICAgY2xhc3M9XCJ0ZXh0LW5vcm1hbFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGI+e3sgYXBwTmFtZSB9fTwvYj5cbiAgICAgICAgICAgIHVzaW5nXG4gICAgICAgICAgICA8Yj57eyBsaWNlbnNlTmFtZSB9fTwvYj5cbiAgICAgICAgICAgIGxpY2Vuc2VcbiAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgKm5nSWY9XCIhbGljZW5zZS5saWNlbnNlTmFtZVwiXG4gICAgICAgICAgICB0cmFuc2xhdGVcbiAgICAgICAgICAgIFt0cmFuc2xhdGVQYXJhbXNdPVwieyBhcHBOYW1lOiBsaWNlbnNlLmFwcE5hbWUsIGxpY2Vuc2VOYW1lOiBsaWNlbnNlLmxpY2Vuc2VOYW1lIH1cIlxuICAgICAgICAgICAgbmdOb25CaW5kYWJsZVxuICAgICAgICAgICAgY2xhc3M9XCJ0ZXh0LW5vcm1hbFwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGI+e3sgYXBwTmFtZSB9fTwvYj5cbiAgICAgICAgICAgIHVzaW5nXG4gICAgICAgICAgICA8Yj5ubyBsaWNlbnNlPC9iPlxuICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgICAgPGM4eS1saWNlbnNlLXZpZXcgW3VybF09XCJsaWNlbnNlLnVybFwiIFtuYW1lXT1cImxpY2Vuc2UubGljZW5zZU5hbWVcIj48L2M4eS1saWNlbnNlLXZpZXc+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8Yzh5LXdpemFyZC1mb290ZXIgKm5nSWY9XCJzdGVwcGVyLnNlbGVjdGVkSW5kZXggPT09IDFcIj5cbiAgICAgICAgICA8Yzh5LWZvcm0tZ3JvdXAgY2xhc3M9XCJ0ZXh0LWNlbnRlciBkLWlubGluZS1ibG9ja1wiPlxuICAgICAgICAgICAgPGRpdiBbZm9ybUdyb3VwXT1cImZvcm1Hcm91cExpY2Vuc2VzXCIgY2xhc3M9XCJkLWZsZXggZC1jb2wgYS1pLWNlbnRlclwiPlxuICAgICAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJjOHktY2hlY2tib3hcIj5cbiAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIiBmb3JtQ29udHJvbE5hbWU9XCJhY2NlcHRBbGxcIiByZXF1aXJlZCAvPlxuICAgICAgICAgICAgICAgIDxzcGFuPjwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cImxpY2Vuc2VzLmxlbmd0aCA9PT0gMVwiIHRyYW5zbGF0ZT5BY2NlcHQgbGljZW5zZTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiAqbmdJZj1cImxpY2Vuc2VzLmxlbmd0aCA+IDFcIiB0cmFuc2xhdGU+QWNjZXB0IGFsbCBsaWNlbnNlczwvc3Bhbj5cbiAgICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgICAgPGM4eS1tZXNzYWdlcyBjbGFzcz1cImQtaW5saW5lLWJsb2NrXCI+XG4gICAgICAgICAgICAgICAgPGM4eS1tZXNzYWdlXG4gICAgICAgICAgICAgICAgICBbbmFtZV09XCIncmVxdWlyZWQnXCJcbiAgICAgICAgICAgICAgICAgIFt0ZXh0XT1cIidZb3UgbmVlZCB0byBhY2NlcHQgdGhlIGxpY2Vuc2UgYWdyZWVtZW50KHMpJyB8IHRyYW5zbGF0ZVwiXG4gICAgICAgICAgICAgICAgPjwvYzh5LW1lc3NhZ2U+XG4gICAgICAgICAgICAgIDwvYzh5LW1lc3NhZ2VzPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9jOHktZm9ybS1ncm91cD5cbiAgICAgICAgICA8aHIgc3R5bGU9XCJtYXJnaW46IDAgLTI0cHggMTZweFwiIC8+XG4gICAgICAgICAgPGM4eS1zdGVwcGVyLWJ1dHRvbnNcbiAgICAgICAgICAgIFt0aXRsZV09XCInQWNjZXB0IGxpY2Vuc2UnIHwgdHJhbnNsYXRlXCJcbiAgICAgICAgICAgIFtzaG93QnV0dG9uc109XCJ7IG5leHQ6IHRydWUsIGNhbmNlbDogdHJ1ZSwgYmFjazogZmFsc2UsIGN1c3RvbTogZmFsc2UgfVwiXG4gICAgICAgICAgICAob25DYW5jZWwpPVwiY2FuY2VsKClcIlxuICAgICAgICAgICAgKG9uTmV4dCk9XCJkb25lKClcIlxuICAgICAgICAgID48L2M4eS1zdGVwcGVyLWJ1dHRvbnM+XG4gICAgICAgIDwvYzh5LXdpemFyZC1mb290ZXI+XG4gICAgICA8L2Nkay1zdGVwPlxuICAgIDwvYzh5LXN0ZXBwZXI+XG4gIDwvZGl2PlxuPC9jOHktd2l6YXJkLWJvZHk+XG4iXX0=