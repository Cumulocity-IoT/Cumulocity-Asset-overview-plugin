import { Component, Input, Output, ViewChild, EventEmitter, ElementRef } from '@angular/core';
import { AppLogsService } from './app-logs.service';
import { fromEvent, Subject, of, interval, NEVER } from 'rxjs';
import { filter, catchError, tap, debounce, switchMap, takeUntil, finalize, delay, repeat, merge, scan } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./app-logs.service";
import * as i2 from "@angular/common";
import * as i3 from "@c8y/ngx-components";
export class AppLogsAutoRefreshComponent {
    constructor(appLogsService) {
        this.appLogsService = appLogsService;
        this.cancel$ = new Subject();
        this.isAutoRefreshDisabled = false;
        this.logsToOutput = this.getEmptyLogsJson();
        this.isAutoRefreshOn = true;
        this.onNewLogs = new EventEmitter();
        this.isRealtimeEnabled = new EventEmitter();
        this.toggleState = currentState => !currentState;
    }
    set buttonsDisabled(areDisabled) {
        this.isAutoRefreshDisabled = areDisabled;
        if (areDisabled && this.isAutoRefreshOn) {
            this.isAutoRefreshOn = false;
            this.cancel$.next(false);
        }
    }
    ngAfterViewInit() {
        const clicks$ = fromEvent(this.button.nativeElement, 'click').pipe(merge(this.cancel$), debounce(() => interval(300)), scan(this.toggleState, false), tap(isAutoRefreshOn => this.setButtonState(isAutoRefreshOn)), switchMap(isOn => (isOn ? this.watchForNewLogs() : NEVER)));
        this.subscription = clicks$.subscribe();
    }
    ngOnDestroy() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    setButtonState(isAutoRefreshOn) {
        this.isAutoRefreshOn = isAutoRefreshOn;
        this.isRealtimeEnabled.emit(isAutoRefreshOn);
    }
    watchForNewLogs() {
        return this.startPolling().pipe(takeUntil(this.cancel$.pipe(filter(isAutoRefreshOn => isAutoRefreshOn === false))), finalize(() => {
            this.isAutoRefreshOn = false;
        }));
    }
    startPolling() {
        return of(1).pipe(switchMap(() => this.getNewLogs().pipe(catchError(() => of(this.getEmptyLogsJson())))), tap(logs => this.updateLogsToOutput(logs)), delay(10000), repeat());
    }
    getNewLogs() {
        return this.appLogsService.getLogs$(this.getAppId(), this.getInstanceName());
    }
    getAppId() {
        return this.mo.applicationId;
    }
    getInstanceName() {
        return this.selectedInstance.name;
    }
    updateLogsToOutput(newLogs) {
        const { dateFrom, dateTo } = newLogs;
        if (dateFrom && dateTo) {
            this.logsToOutput = { ...newLogs };
            this.onNewLogs.emit(this.logsToOutput);
        }
    }
    getEmptyLogsJson() {
        return {
            dateFrom: null,
            dateTo: null,
            logs: '',
            truncated: false
        };
    }
}
AppLogsAutoRefreshComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: AppLogsAutoRefreshComponent, deps: [{ token: i1.AppLogsService }], target: i0.ɵɵFactoryTarget.Component });
AppLogsAutoRefreshComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.0.6", type: AppLogsAutoRefreshComponent, selector: "c8y-app-logs-auto-refresh", inputs: { selectedInstance: "selectedInstance", mo: "mo", buttonsDisabled: "buttonsDisabled" }, outputs: { onNewLogs: "onNewLogs", isRealtimeEnabled: "isRealtimeEnabled" }, viewQueries: [{ propertyName: "button", first: true, predicate: ["autoRefresh"], descendants: true, static: true }], ngImport: i0, template: "<button #autoRefresh\n  type=\"button\"\n  class=\"btn btn-link c8y-realtime\"\n  [ngStyle]=\"{'width': 'auto'}\"\n  title=\"{{'Toggle auto refresh' | translate}}\"\n  [disabled]=\"isAutoRefreshDisabled\"\n>\n  <span class=\"c8y-pulse\" [ngClass]=\"isAutoRefreshOn ? 'active' : 'inactive'\"></span>\n  {{'Auto refresh' | translate}}\n</button>", dependencies: [{ kind: "directive", type: i2.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i2.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "pipe", type: i3.C8yTranslatePipe, name: "translate" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.0.6", ngImport: i0, type: AppLogsAutoRefreshComponent, decorators: [{
            type: Component,
            args: [{ selector: 'c8y-app-logs-auto-refresh', template: "<button #autoRefresh\n  type=\"button\"\n  class=\"btn btn-link c8y-realtime\"\n  [ngStyle]=\"{'width': 'auto'}\"\n  title=\"{{'Toggle auto refresh' | translate}}\"\n  [disabled]=\"isAutoRefreshDisabled\"\n>\n  <span class=\"c8y-pulse\" [ngClass]=\"isAutoRefreshOn ? 'active' : 'inactive'\"></span>\n  {{'Auto refresh' | translate}}\n</button>" }]
        }], ctorParameters: function () { return [{ type: i1.AppLogsService }]; }, propDecorators: { selectedInstance: [{
                type: Input
            }], mo: [{
                type: Input
            }], buttonsDisabled: [{
                type: Input
            }], onNewLogs: [{
                type: Output
            }], isRealtimeEnabled: [{
                type: Output
            }], button: [{
                type: ViewChild,
                args: ['autoRefresh', { static: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLWxvZ3MtYXV0by1yZWZyZXNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2FwcC1sb2dzL2FwcC1sb2dzLWF1dG8tcmVmcmVzaC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi9hcHAtbG9ncy9hcHAtbG9ncy1hdXRvLXJlZnJlc2guY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTlGLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLEVBQWMsU0FBUyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBZ0IsTUFBTSxNQUFNLENBQUM7QUFDekYsT0FBTyxFQUNMLE1BQU0sRUFDTixVQUFVLEVBQ1YsR0FBRyxFQUNILFFBQVEsRUFDUixTQUFTLEVBQ1QsU0FBUyxFQUNULFFBQVEsRUFDUixLQUFLLEVBQ0wsTUFBTSxFQUNOLEtBQUssRUFDTCxJQUFJLEVBQ0wsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7QUFNeEIsTUFBTSxPQUFPLDJCQUEyQjtJQXFCdEMsWUFBb0IsY0FBOEI7UUFBOUIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBcEJsRCxZQUFPLEdBQXFCLElBQUksT0FBTyxFQUFXLENBQUM7UUFDbkQsMEJBQXFCLEdBQUcsS0FBSyxDQUFDO1FBQzlCLGlCQUFZLEdBQWEsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7UUFDakQsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFXYixjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQVksQ0FBQztRQUN6QyxzQkFBaUIsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBdUJsRCxnQkFBVyxHQUFHLFlBQVksQ0FBQyxFQUFFLENBQUMs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LEVBQUUsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDO1FBQ3JDLElBQUksUUFBUSxJQUFJLE1BQU0sRUFBRTtZQUN0QixJQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsR0FBRyxPQUFPLEVBQUUsQ0FBQztZQUNuQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDeEM7SUFDSCxDQUFDO0lBRU8sZ0JBQWdCO1FBQ3RCLE9BQU87WUFDTCxRQUFRLEVBQUUsSUFBSTtZQUNkLE1BQU0sRUFBRSxJQUFJO1lBQ1osSUFBSSxFQUFFLEVBQUU7WUFDUixTQUFTLEVBQUUsS0FBSztTQUNqQixDQUFDO0lBQ0osQ0FBQzs7d0hBMUZVLDJCQUEyQjs0R0FBM0IsMkJBQTJCLG1XQ3RCeEMseVZBU1M7MkZEYUksMkJBQTJCO2tCQUp2QyxTQUFTOytCQUNFLDJCQUEyQjtxR0FTNUIsZ0JBQWdCO3NCQUF4QixLQUFLO2dCQUNHLEVBQUU7c0JBQVYsS0FBSztnQkFDTyxlQUFlO3NCQUEzQixLQUFLO2dCQU9JLFNBQVM7c0JBQWxCLE1BQU07Z0JBQ0csaUJBQWlCO3NCQUExQixNQUFNO2dCQUNxQyxNQUFNO3NCQUFqRCxTQUFTO3VCQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIFZpZXdDaGlsZCwgRXZlbnRFbWl0dGVyLCBFbGVtZW50UmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBMb2dzSlNPTiB9IGZyb20gJy4vbG9ncy5tb2RlbCc7XG5pbXBvcnQgeyBBcHBMb2dzU2VydmljZSB9IGZyb20gJy4vYXBwLWxvZ3Muc2VydmljZSc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tRXZlbnQsIFN1YmplY3QsIG9mLCBpbnRlcnZhbCwgTkVWRVIsIFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgZmlsdGVyLFxuICBjYXRjaEVycm9yLFxuICB0YXAsXG4gIGRlYm91bmNlLFxuICBzd2l0Y2hNYXAsXG4gIHRha2VVbnRpbCxcbiAgZmluYWxpemUsXG4gIGRlbGF5LFxuICByZXBlYXQsXG4gIG1lcmdlLFxuICBzY2FuXG59IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWFwcC1sb2dzLWF1dG8tcmVmcmVzaCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9hcHAtbG9ncy1hdXRvLXJlZnJlc2guY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEFwcExvZ3NBdXRvUmVmcmVzaENvbXBvbmVudCB7XG4gIGNhbmNlbCQ6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdDxib29sZWFuPigpO1xuICBpc0F1dG9SZWZyZXNoRGlzYWJsZWQgPSBmYWxzZTtcbiAgbG9nc1RvT3V0cHV0OiBMb2dzSlNPTiA9IHRoaXMuZ2V0RW1wdHlMb2dzSnNvbigpO1xuICBpc0F1dG9SZWZyZXNoT24gPSB0cnVlO1xuXG4gIEBJbnB1dCgpIHNlbGVjdGVkSW5zdGFuY2U6IGFueTtcbiAgQElucHV0KCkgbW86IGFueTtcbiAgQElucHV0KCkgc2V0IGJ1dHRvbnNEaXNhYmxlZChhcmVEaXNhYmxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuaXNBdXRvUmVmcmVzaERpc2FibGVkID0gYXJlRGlzYWJsZWQ7XG4gICAgaWYgKGFyZURpc2FibGVkICYmIHRoaXMuaXNBdXRvUmVmcmVzaE9uKSB7XG4gICAgICB0aGlzLmlzQXV0b1JlZnJlc2hPbiA9IGZhbHNlO1xuICAgICAgdGhpcy5jYW5jZWwkLm5leHQoZmFsc2UpO1xuICAgIH1cbiAgfVxuICBAT3V0cHV0KCkgb25OZXdMb2dzID0gbmV3IEV2ZW50RW1pdHRlcjxMb2dzSlNPTj4oKTtcbiAgQE91dHB1dCgpIGlzUmVhbHRpbWVFbmFibGVkID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xuICBAVmlld0NoaWxkKCdhdXRvUmVmcmVzaCcsIHsgc3RhdGljOiB0cnVlIH0pIGJ1dHRvbjogRWxlbWVudFJlZjtcblxuICBwcml2YXRlIHN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgYXBwTG9nc1NlcnZpY2U6IEFwcExvZ3NTZXJ2aWNlKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICBjb25zdCBjbGlja3MkID0gZnJvbUV2ZW50KHRoaXMuYnV0dG9uLm5hdGl2ZUVsZW1lbnQsICdjbGljaycpLnBpcGUoXG4gICAgICBtZXJnZSh0aGlzLmNhbmNlbCQpLFxuICAgICAgZGVib3VuY2UoKCkgPT4gaW50ZXJ2YWwoMzAwKSksXG4gICAgICBzY2FuKHRoaXMudG9nZ2xlU3RhdGUsIGZhbHNlKSxcbiAgICAgIHRhcChpc0F1dG9SZWZyZXNoT24gPT4gdGhpcy5zZXRCdXR0b25TdGF0ZShpc0F1dG9SZWZyZXNoT24pKSxcbiAgICAgIHN3aXRjaE1hcChpc09uID0+IChpc09uID8gdGhpcy53YXRjaEZvck5ld0xvZ3MoKSA6IE5FVkVSKSlcbiAgICApO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gY2xpY2tzJC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbiAgcHJpdmF0ZSB0b2dnbGVTdGF0ZSA9IGN1cnJlbnRTdGF0ZSA9PiAhY3VycmVudFN0YXRlO1xuXG4gIHByaXZhdGUgc2V0QnV0dG9uU3RhdGUoaXNBdXRvUmVmcmVzaE9uOiBib29sZWFuKSB7XG4gICAgdGhpcy5pc0F1dG9SZWZyZXNoT24gPSBpc0F1dG9SZWZyZXNoT247XG4gICAgdGhpcy5pc1JlYWx0aW1lRW5hYmxlZC5lbWl0KGlzQXV0b1JlZnJlc2hPbik7XG4gIH1cblxuICBwcml2YXRlIHdhdGNoRm9yTmV3TG9ncygpIHtcbiAgICByZXR1cm4gdGhpcy5zdGFydFBvbGxpbmcoKS5waXBlKFxuICAgICAgdGFrZVVudGlsKHRoaXMuY2FuY2VsJC5waXBlKGZpbHRlcihpc0F1dG9SZWZyZXNoT24gPT4gaXNBdXRvUmVmcmVzaE9uID09PSBmYWxzZSkpKSxcbiAgICAgIGZpbmFsaXplKCgpID0+IHtcbiAgICAgICAgdGhpcy5pc0F1dG9SZWZyZXNoT24gPSBmYWxzZTtcbiAgICAgIH0pXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRQb2xsaW5nKCkge1xuICAgIHJldHVybiBvZigxKS5waXBlKFxuICAgICAgc3dpdGNoTWFwKCgpID0+IHRoaXMuZ2V0TmV3TG9ncygpLnBpcGUoY2F0Y2hFcnJvcigoKSA9PiBvZih0aGlzLmdldEVtcHR5TG9nc0pzb24oKSkpKSksXG4gICAgICB0YXAobG9ncyA9PiB0aGlzLnVwZGF0ZUxvZ3NUb091dHB1dChsb2dzKSksXG4gICAgICBkZWxheSgxMDAwMCksXG4gICAgICByZXBlYXQoKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGdldE5ld0xvZ3MoKTogT2JzZXJ2YWJsZTxMb2dzSlNPTj4ge1xuICAgIHJldHVybiB0aGlzLmFwcExvZ3NTZXJ2aWNlLmdldExvZ3MkKHRoaXMuZ2V0QXBwSWQoKSwgdGhpcy5nZXRJbnN0YW5jZU5hbWUoKSk7XG4gIH1cblxuICBwcml2YXRlIGdldEFwcElkKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubW8uYXBwbGljYXRpb25JZDtcbiAgfVxuICBwcml2YXRlIGdldEluc3RhbmNlTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGVkSW5zdGFuY2UubmFtZTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlTG9nc1RvT3V0cHV0KG5ld0xvZ3MpIHtcbiAgICBjb25zdCB7IGRhdGVGcm9tLCBkYXRlVG8gfSA9IG5ld0xvZ3M7XG4gICAgaWYgKGRhdGVGcm9tICYmIGRhdGVUbykge1xuICAgICAgdGhpcy5sb2dzVG9PdXRwdXQgPSB7IC4uLm5ld0xvZ3MgfTtcbiAgICAgIHRoaXMub25OZXdMb2dzLmVtaXQodGhpcy5sb2dzVG9PdXRwdXQpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0RW1wdHlMb2dzSnNvbigpOiBMb2dzSlNPTiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGVGcm9tOiBudWxsLFxuICAgICAgZGF0ZVRvOiBudWxsLFxuICAgICAgbG9nczogJycsXG4gICAgICB0cnVuY2F0ZWQ6IGZhbHNlXG4gICAgfTtcbiAgfVxufVxuIiwiPGJ1dHRvbiAjYXV0b1JlZnJlc2hcbiAgdHlwZT1cImJ1dHRvblwiXG4gIGNsYXNzPVwiYnRuIGJ0bi1saW5rIGM4eS1yZWFsdGltZVwiXG4gIFtuZ1N0eWxlXT1cInsnd2lkdGgnOiAnYXV0byd9XCJcbiAgdGl0bGU9XCJ7eydUb2dnbGUgYXV0byByZWZyZXNoJyB8IHRyYW5zbGF0ZX19XCJcbiAgW2Rpc2FibGVkXT1cImlzQXV0b1JlZnJlc2hEaXNhYmxlZFwiXG4+XG4gIDxzcGFuIGNsYXNzPVwiYzh5LXB1bHNlXCIgW25nQ2xhc3NdPVwiaXNBdXRvUmVmcmVzaE9uID8gJ2FjdGl2ZScgOiAnaW5hY3RpdmUnXCI+PC9zcGFuPlxuICB7eydBdXRvIHJlZnJlc2gnIHwgdHJhbnNsYXRlfX1cbjwvYnV0dG9uPiJdfQ==